!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.futureFlow=e():t.futureFlow=e()}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){function i(t,e){var i=[],s=[];return null==e&&(e=function(t,e){return i[0]===e?"[Circular ~]":"[Circular ~."+s.slice(0,i.indexOf(e)).join(".")+"]"}),function(o,n){if(i.length>0){var h=i.indexOf(this);~h?i.splice(h+1):i.push(this),~h?s.splice(h,1/0,o):s.push(o),~i.indexOf(n)&&(n=e.call(this,o,n))}else i.push(n);return null==t?n:t.call(this,o,n)}}(t.exports=function(t,e,s,o){return JSON.stringify(t,i(e,o),s)}).getSerialize=i},function(t,e,i){"use strict";i.r(e),i.d(e,"Flow",(function(){return _})),i.d(e,"isMobile",(function(){return b}));const s=function(t,e,i,s,o,n,h,r,a){return{x:Math.pow(1-t,3)*e+3*t*Math.pow(1-t,2)*s+3*t*t*(1-t)*n+t*t*t*r,y:Math.pow(1-t,3)*i+3*t*Math.pow(1-t,2)*o+3*t*t*(1-t)*h+t*t*t*a}},o=function(t,e,i,s,o,n,h){return{x:(1-t)*(1-t)*e+2*(1-t)*t*s+t*t*n,y:(1-t)*(1-t)*i+2*(1-t)*t*o+t*t*h}},n=function({startPoint:t,controlPoint1:e,controlPoint2:i,endPoint:n,numberOfPointsToGenerate:h}){let r=[],a=h||50;for(let h=0;h<=a;h++){let l=null;l=i?s(h/a,t.x,t.y,e.x,e.y,i.x,i.y,n.x,n.y):o(h/a,t.x,t.y,e.x,e.y,n.x,n.y),r.push(l)}return r};class h{static FLOW_SPEED(){return 1}static FLOW_TYPE(){return"circle"}static PARTICLE_FILL_COLOR(){return"rgb(212, 212, 212)"}static FLOW_PARTICLE_DISTANCE(){return 5}constructor({from:t,to:e,line:i,connector:s,isEditable:o,animation:n,showPathPoints:r}){this._from=t,this.to=e,this.line=i,this.connector=s,this.isEditable=o,this._particles=[],this._animationStarted=!1,this._flow=!0,this._path=this._newPath,this.showPathPoints=!1,this._oldToPosition={x:e.x,y:e.y},this._oldToDimensions={width:e._width,height:e._height},this._oldFromPosition={x:t.x,y:t.y},this._oldFromDimensions={width:t.width,height:t.height},this._pathPoints=[],n&&(this.animation={speed:n.speed||h.FLOW_SPEED(),fillColor:n.fillColor||h.PARTICLE_FILL_COLOR(),type:n.type||h.FLOW_TYPE(),particleDistance:n.particleDistance||h.FLOW_PARTICLE_DISTANCE()})}get _connectionPoints(){let t=1/0,e={};return this._from._sides.forEach(i=>{this.to._sides.forEach(s=>{const o=Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2));o<t&&(t=o,e={from:i,to:s})})}),e}get _newPath(){let t=this._connectionPoints,e=t.from,i=t.to,s=Math.abs(i.x-e.x)/2,o=Math.abs(i.y-e.y)/2,n=[];return"left"===e.name&&"right"===i.name||"right"===e.name&&"left"===i.name?(e.x>i.x&&(s*=-1),n.push({x:parseInt(e.x.toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt((e.x+s).toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt((i.x-s).toFixed(0)),y:parseInt(i.y.toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt(i.y.toFixed(0))})):"bottom"!==e.name&&"top"!==e.name||"right"!==i.name&&"left"!==i.name?"right"!==e.name&&"left"!==e.name||"top"!==i.name&&"bottom"!==i.name?("top"===e.name&&"bottom"===i.name||"bottom"===e.name&&"top"===i.name)&&(e.y>i.y&&(o*=-1),n.push({x:parseInt(e.x.toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt(e.x.toFixed(0)),y:parseInt((e.y+o).toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt((i.y-o).toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt(i.y.toFixed(0))})):n.push({x:parseInt(e.x.toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt(i.y.toFixed(0))}):n.push({x:parseInt(e.x.toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt(e.x.toFixed(0)),y:parseInt(i.y.toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt(i.y.toFixed(0))}),n}draw(t){let e=!1;this._oldFromPosition.x!==this._from.x||this._oldFromPosition.y!==this._from.y?(this._oldFromPosition.x=this._from.x,this._oldFromPosition.y=this._from.y,e=!0):this._oldToPosition.x!==this.to.x||this._oldToPosition.y!==this.to.y?(this._oldToPosition.x=this.to.x,this._oldToPosition.y=this.to.y,e=!0):this._oldFromDimensions.width!==this._from._width||this._oldFromDimensions.height!==this._from._height?(this._oldFromDimensions.width=this._from._width,this._oldFromDimensions.height=this._from._height,e=!0):this._oldToDimensions.width===this.to._width&&this._oldToDimensions.height===this.to._height||(this._oldToDimensions.width=this.to._width,this._oldToDimensions.height=this.to._height,e=!0);let i=this._path;if(e&&(i=this._newPath,this._path=i),i.length>0){t.save(),this.line?(t.lineWidth=this.line.width||2,t.strokeStyle=this.line.color||"rgb(212,212,212)",this.line.dashed&&t.setLineDash(this.line.dashed)):(t.lineWidth=2,t.strokeStyle="rgb(212,212,212)"),t.lineWidth=1,t.lineCap="square",t.beginPath();const s=i[0];if(t.moveTo(s.x,s.y),this.line&&this.line.bezierCurve)if(3===i.length){const o=i[1],h=i[2];this._pathPoints=e?n({startPoint:s,controlPoint1:o,endPoint:h}):this._pathPoints,t.quadraticCurveTo(o.x,o.y,h.x,h.y)}else{const o=i[1],h=i[2],r=i[3];this._pathPoints=e?n({startPoint:s,controlPoint1:o,controlPoint2:h,endPoint:r}):this._pathPoints,t.bezierCurveTo(o.x,o.y,h.x,h.y,r.x,r.y)}else{this._pathPoints=e?function(t){let e=[];for(let i=1;i<t.length;i++){const s=t[i];if(s.x===t[i-1].x){const o=(s.y-t[i-1].y)/50;for(let n=0;n<50;n++)e.push({x:s.x,y:t[i-1].y+o*n})}else if(s.y===t[i-1].y){const o=(s.x-t[i-1].x)/50;for(let n=0;n<50;n++)e.push({x:t[i-1].x+o*n,y:s.y})}}return e.push({x:t[t.length-1].x,y:t[t.length-1].y}),e}(i):this._pathPoints;for(let e=1;e<i.length;e++){const s=i[e];t.lineTo(s.x,s.y)}}if(t.stroke(),t.closePath(),t.restore(),this.showPathPoints&&this._pathPoints.length){i=this._pathPoints,t.save(),t.fillStyle="red";for(let e=0;e<this._pathPoints.length-1;e++)t.beginPath(),t.arc(this._pathPoints[e].x,this._pathPoints[e].y,1,0,2*Math.PI),t.fill();t.restore()}if(this.animation&&this._animationStarted){0===this._particles.length&&this._particles.push({x:this._pathPoints[0].x,y:this._pathPoints[0].y,toIndex:1,to:this._pathPoints[1],addedParticle:!1,distance:0});for(let e=0;e<this._particles.length;e++){let i=this._particles[e];this._pathPoints.length&&(i.toIndex>this.animation.particleDistance&&!i.addedParticle&&this._flow&&(this._particles.push({x:this._pathPoints[0].x,y:this._pathPoints[0].y,toIndex:1,to:this._pathPoints[1],addedParticle:!1}),i.addedParticle=!0),i.toIndex++,i.toIndex>=this._pathPoints.length?this._particles.splice(0,1):(i.x=i.to.x,i.y=i.to.y,i.to=this._pathPoints[i.toIndex]),0===this._particles.length&&this.stopAnimation()),t.beginPath(),t.fillStyle=this.animation.fillColor,t.moveTo(i.x,i.y),"circle"===this.animation.type&&t.arc(i.x,i.y,5,0,2*Math.PI),t.fill(),t.closePath()}}let o=this._path[this._path.length-1],h=this._path[this._path.length-2];o.x==h.x?o.y>h.y?(t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(o.x+10,o.y-10),t.lineTo(o.x-10,o.y-10)):(t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(o.x-10,o.y+10),t.lineTo(o.x+10,o.y+10)):o.x>h.x?(t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(o.x-10,o.y-10),t.lineTo(o.x-10,o.y+10)):(t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(o.x+10,o.y-10),t.lineTo(o.x+10,o.y+10)),this.connector?(t.strokeStyle=this.connector.color||"rgb(212,212,212)",t.lineWidth=this.connector.width||"rgb(212,212,212)",t.fillStyle=this.connector.fillColor||"rgb(212,212,212)"):(t.strokeStyle="rgb(212,212,212)",t.lineWidth="rgb(212,212,212)",t.fillStyle="rgb(212,212,212)"),t.stroke(),t.fill(),t.closePath()}}startAnimation(){this._animationStarted=!0}restartAnimation(){this.stopAnimation(),this.startAnimation()}endFlow(){this._flow=!1}stopAnimation(){this._particles=[],this._animationStarted=!1}}var r=i(0),a=i.n(r);class l extends class{constructor(){this.callbacks={}}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}emit(t,e){let i=this.callbacks[t];i&&i.forEach(t=>t(e))}}{static MAX_WIDTH(){return 350}static MAX_HEIGHT(){return 500}static PADDING(){return{top:15,right:15,bottom:15,left:15}}static ICON(){return{width:25,height:25}}static BACKGROUND(){return{color:"rgb(255,255,255)"}}static BORDER(){return{radius:5,normal:{width:1,color:"black"},selected:{width:1,color:"black"},hover:{width:1,color:"black"}}}constructor({x:t,y:e,width:i,height:s,name:o}){super(),this._id=+new Date+1e5*Math.random(),this.name=o,this.x=t,this.y=e,this._width=i,this._height=s,this.connections=[],this._selected=!1,this._hover=!1}get _sides(){return[{x:this.x+this._width/2,y:this.y,name:"top"},{x:this.x+this._width,y:this.y+this._height/2,name:"right"},{x:this.x+this._width/2,y:this.y+this._height,name:"bottom"},{x:this.x,y:this.y+this._height/2,name:"left"}]}set state(t){this.states.includes(t)&&this.emit(t,{detail:this})}createEvent(t){return new CustomEvent(t,{detail:this})}addConnection(t){t.from=this;const e=new h(t);this.connections.push(e)}contains(t,e){return t>=this.x&&t<=this.x+this._width&&e>=this.y&&e<=this.y+this._height}startAnimation(t){this.getConnection(t).startAnimation()}startAllAnimations(){this.connections.forEach(t=>{t.startAnimation()})}finishAllAnimations(){this.connections.forEach(t=>{t.finishAnimation()})}stopAnimation(t){this.getConnection(t).stopAnimation()}finishAnimation(t){this.getConnection(t).finishAnimation()}getConnection(t){return this.connections.find(e=>e.to.name===t.name)}getConnectionByName(t){return this.connections.find(e=>e.to.name===t)}removeConnection(t){for(let e=0;e<this.connections.length;e++)if(this.connections[e].to.name===t.name)return void this.connections.splice(e,1)}toString(){let t=[];return this.connections.forEach(e=>{t.push({id:e.to.id,name:e.to.name})}),a()({id:this._id,name:this.name,position:{x:this.x,y:this.y},connections:t,content:{header:this.header?this.header.text:null,body:this.body?this.body.text:null,footer:this.footer?this.footer.text:null},border:this.border,background:this.background},null,4)}prettier(){return"string"!=typeof(t=this.toString())&&(t=JSON.stringify(t,void 0,2)),(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(function(t){var e="number";return/^"/.test(t)?e=/:$/.test(t)?"key":"string":/true|false/.test(t)?e="boolean":/null/.test(t)&&(e="null"),'<span class="'+e+'">'+t+"</span>"}));var t}}class d extends l{constructor(t,e,i,s){super(t,e,i,s)}get area(){return this._width*this._height}get center(){return{x:this.x+this._width/2,y:this.y+this._height/2}}draw(t){super.draw(t),t.fillStyle="black",t.beginPath(),t.rect(this.x,this.y,this._width,this._height),t.stroke(),Object.values(this._sides).forEach(e=>{t.beginPath(),t.strokeStyle="red",t.arc(e.x,e.y,2,0,2*Math.PI,!0),t.stroke()}),this.connections.forEach(e=>{e.draw(t),Object.values(e.closesPoints).forEach(e=>{t.beginPath(),t.strokeStyle="green",t.arc(e.x,e.y,2,0,2*Math.PI,!0),t.stroke()})})}}const c=t=>t.replace(/\s/g,"");class g{static rgbRegex(){return new RegExp("rgb\\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3}\\)|rgba\\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3},(([0]*?.d*)|1|0)\\)","gi")}static rgbaRegex(){return new RegExp("rgb\\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3}\\)|rgba\\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3},(([0]*?.d*)|1|0)\\)","gi")}static hexRegex(){return new RegExp("^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$","gi")}static isRGB(t){return null!==c(t).match(g.rgbRegex())}static isRGBA(t){return null!==c(t).match(g.rgbaRegex())}static isHEX(t){return null!==c(t).match(g.hexRegex())}static string2Color(t){if(g.isRGB(t)||g.isRGBA(t)){let e=c(t).replace("rgb(","").replace("rgba(","").replace(")","").split(",");return{red:e[0],green:e[1],blue:e[2],alpha:e[3]||1}}if(g.isHEX(t)){const e=(t=c(t).replace("#","")).length/3;return{red:parseInt(t.substring(0,e),16),green:parseInt(t.substring(e,2*e),16),blue:parseInt(t.substring(2*e,3*e),16),alpha:1}}return{red:0,green:0,blue:0,alpha:1}}static rgbToHex(t){const e=(t=t.replace(/\s/g,"")).replace("rgb(","").replace("rgba(","").replace(")","").split(",");let i="#";return e.forEach((t,e)=>{if(3!=e){const e=Number(t).toString(16);i+=2===e.length?e:"0"+e}}),i}constructor(t){"string"==typeof t&&(t=g.string2Color(t)),this._red=t.red,this._green=t.green,this._blue=t.blue,this._alpha=t.alpha||1}get rgb(){return`rgb(${this._red},${this._green},${this._blue})`}get rgba(){return`rgba(${this._red},${this._green},${this._blue},${this._alpha})`}get hex(){return g.rgbToHex(this.rgb)}}class f{constructor({color:t}){this._color=new g(t)}get color(){return this._color}set color(t){this._color=new g(t)}}class y{constructor({top:t,right:e,bottom:i,left:s}){this._top=t,this._right=e,this._bottom=i,this._left=s}get top(){return this._top}get right(){return this._right}get bottom(){return this._bottom}get left(){return this._left}set top(t){this._top=t}set right(t){this._right=t}set bottom(t){this._bottom=t}set left(t){this._left=t}}class u{constructor({family:t,style:e,variant:i,color:s,size:o,weight:n}){this._family=t,this._style=e,this._variant=i,this._color=new g(s),this._size=o,this._weight=n}get font2Canvas(){return`${this._style} ${this._variant} ${this._weight} ${this._size}px ${this._family}`}get family(){return this._family}get style(){return this._style}get variant(){return this._variant}get color(){return this._color}get size(){return this._size}get weight(){return this._weight}get dimensions(){return function({fontFamily:t,fontSize:e,fontWeight:i,element:s}){const o=s||document.body;var n=document.createElement("span");n.innerHTML="Hg",n.setAttribute("style",`font-family: ${t} !important; font-size: ${e}px !important; font-weight:${i} !important;`);var h=document.createElement("div");h.style.display="inline-block",h.style.width="1px",h.style.height="0px";var r=document.createElement("div");r.appendChild(n),r.appendChild(h),o.appendChild(r);try{var a={};h.style.verticalAlign="baseline",a.ascent=h.offsetTop-n.offsetTop,h.style.verticalAlign="bottom",a.height=h.offsetTop-n.offsetTop,a.descent=a.height-a.ascent}finally{r.remove()}return a}({fontFamily:this._family,fontSize:this._size,fontWeight:this._weight})}}class p{constructor({radius:t,color:e,width:i,selected:s,hover:o}){this._radius=t,this._width=i,this._color=new g(e),this._selected=s?new p({width:s.width,color:s.color}):null,this._hover=o?new p({width:o.width,color:o.color}):null}get radius(){return this._radius}set radius(t){this._radius=t}get color(){return this._color}set color(t){this._color=new g(t)}get selected(){return this._selected}get hover(){return this._hover}}class x extends d{constructor({x:t,y:e,name:i,isDraggable:s,background:o,shadow:n,border:h,header:r,body:a,padding:d,footer:c,state:g,states:x}){super({x:t||0,y:e||0,width:1,height:1,name:i}),this.x=t||0,this.y=e||0,this.background=o?new f(o):l.BACKGROUND(),this.padding=d?new y(d):l.PADDING(),this.border=h?new p(h):l.BORDER(),this.shadow=n,this.isDraggable=s||!1,this.states=x||[],this.state=g,r&&(this.header=r,this.header.font=new u(r.font),this.header.padding=r.padding?new y(r.padding):l.PADDING()),a&&(this.body=a,this.body.font=new u(a.font),this.body.padding=a.padding?new y(a.padding):l.PADDING()),c&&(this.footer=c,this.footer.font=new u(c.font),this.footer.padding=c.padding?new y(c.padding):l.PADDING()),this.on("mouseenter",()=>{this._hover=!0}),this.on("mouseleave",()=>{this._hover=!1})}draw(t){let e=this.border.radius;var i=this.x+this._width,s=this.y+this._height;t.save(),this.shadow&&(t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offset.x,t.shadowOffsetY=this.shadow.offset.y),t.strokeStyle=this.border.color.hex,t.fillStyle=this.background.color.hex,t.lineWidth=this.border.width,this._selected&&(t.strokeStyle=this.border.selected.color.hex,t.lineWidth=this.border.selected.width),this._hover&&(t.strokeStyle=this.border.hover.color.hex,t.lineWidth=this.border.hover.width),t.beginPath(),t.moveTo(this.x+e,this.y),t.lineTo(i-e,this.y),t.quadraticCurveTo(i,this.y,i,this.y+e),t.lineTo(i,this.y+this._height-e),t.quadraticCurveTo(i,s,i-e,s),t.lineTo(this.x+e,s),t.quadraticCurveTo(this.x,s,this.x,s-e),t.lineTo(this.x,this.y+e),t.quadraticCurveTo(this.x,this.y,this.x+e,this.y),t.closePath(),t.stroke(),t.fill(),t.restore();let o=0,n=0;if(this.header){t.textBaseline="top",t.font=`${this.header.font.style} ${this.header.font.variant} ${this.header.font.weight} ${this.header.font.size}px ${this.header.font.family}`,t.fillStyle=this.header.font.color.hex,t.textAlign=this.header.alignment;let e,i=0,s=0;this.header.icon&&(i=l.ICON().width,s=l.ICON().height,t.drawImage(img,this.x+this.header.padding.left,this.y+this.header.padding.top,i,s)),this.header.font.dimensions.height<s?(o=this.header.padding.top+s+this.header.padding.bottom,e=(o-this.header.font.dimensions.ascent)/2):(o=this.header.padding.top+this.header.font.dimensions.ascent+this.header.padding.bottom,e=this.header.padding.top),n=0!==i?this.header.padding.left+i+this.header.padding.right+t.measureText(this.header.text).width+this.header.padding.right:t.measureText(this.header.text).width;let h=0;h="center"===this.header.alignment?this.x+this._width/2:this.x+i+this.header.padding.right+(this.header.icon?this.header.padding.left:0),t.fillText(this.header.text,h,this.y+e),this.header.divider&&(t.save(),t.strokeStyle=this.header.divider.color,t.lineWidth=this.header.divider.width,t.beginPath(),t.moveTo(this.x,this.y+o),t.lineTo(this.x+this._width,this.y+o),t.stroke(),t.closePath(),t.restore())}let h=0,r=0;if(this.body){t.save(),t.font=this.body.font.font2Canvas,t.fillStyle=this.body.font.color.hex,t.textAlign=this.body.alignment,t.textBaseline="top";let e=[];const i=this.body.text.split(" ");let s=0;i.forEach(i=>{const o=t.measureText(i).width,n=t.measureText(e[s]||"").width;this.body.padding.left+n+o+this.body.padding.right>l.MAX_WIDTH()&&s++;let h=e[s]||"";e[s]=h+=(h.length>0?" ":"")+i}),e.forEach((e,i)=>{const s=this.y+o+this.body.font.dimensions.height*i+this.body.padding.top;t.fillText(e,this.x+this.body.padding.left,s);const n=t.measureText(e).width;r=n>r?n:r}),h=this.body.padding.top+e.length*this.body.font.dimensions.height+this.body.padding.bottom,r+=this.body.padding.left+this.body.padding.right,t.restore()}let a=0,d=0;this.footer&&(this.footer.divider&&(t.save(),t.strokeStyle=this.footer.divider.color,t.lineWidth=this.footer.divider.width,t.beginPath(),t.moveTo(this.x,this.y+o+h),t.lineTo(this.x+this._width,this.y+o+h),t.stroke(),t.closePath(),t.restore()),t.textBaseline="top",t.font=`${this.footer.font.style} ${this.footer.font.variant} ${this.footer.font.weight} ${this.footer.font.size}px ${this.footer.font.family}`,t.fillStyle=this.footer.font.color.hex,t.textAlign=this.footer.alignment,t.alignment="top",t.fillText(this.footer.text,this.x+this.footer.padding.left,this.y+o+h+this.footer.padding.top),a=this.footer.padding.top+this.footer.font.dimensions.height+this.footer.padding.bottom,d=this.footer.padding.left+t.measureText(this.footer.text).width+this.footer.padding.right);const c=n>r&&n>d?n:r>d?r:d,g=o+h+a;this._width=c>0?c:100,this._height=g>0?g:100,this._width=parseInt(this._width.toFixed(0)),this._height=parseInt(this._height.toFixed(0)),this.connections.forEach(e=>{e.draw(t)})}}class m extends l{constructor({x:t,y:e,name:i,isDraggable:s,background:o,shadow:n,border:h,body:r,state:a,states:d}){super({x:t||0,y:e||0,width:1,height:1,name:i}),this.x=t||0,this.y=e||0,this.background=new f(o)||l.BACKGROUND(),this.border=h?new p(h):l.BORDER(),this.shadow=n,this.isDraggable=s||!1,this.states=d||[],this.state=a,r&&(this.body=r,this.body.font=new u(r.font),this.body.padding=r.padding?new y(r.padding):l.PADDING()),this.on("mouseenter",()=>{this._hover=!0}),this.on("mouseleave",()=>{this._hover=!1})}draw(t){let e=this.border.radius;const i=this._sides,s=i[0],o=i[1],n=i[2],h=i[3];t.save(),this.shadow&&(t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offset.x,t.shadowOffsetY=this.shadow.offset.y),t.strokeStyle=this.border.color.hex,t.lineWidth=this.border.width,t.fillStyle=this.background.color.rgba,this._selected&&(t.strokeStyle=this.border.selected.color.rgba,t.lineWidth=this.border.selected.width),this._hover&&(t.strokeStyle=this.border.hover.color.rgba,t.lineWidth=this.border.hover.width),t.beginPath(),t.moveTo(s.x-e,s.y+e),t.quadraticCurveTo(s.x,s.y+.5*e,s.x+e,s.y+e),t.lineTo(o.x-e,o.y-e),t.quadraticCurveTo(o.x,o.y,o.x-e,o.y+e),t.lineTo(n.x+e,n.y-e),t.quadraticCurveTo(n.x,n.y-.5*e,n.x-e,n.y-e),t.lineTo(h.x+e,h.y+e),t.quadraticCurveTo(h.x,h.y,h.x+e,h.y-e),t.lineTo(s.x-e,s.y+e),t.closePath(),t.lineWidth&&t.stroke(),t.fill(),t.restore();let r=0,a=0;if(this.body){t.save(),t.font=`${this.body.font.style} ${this.body.font.variant} ${this.body.font.weight} ${this.body.font.size}px ${this.body.font.family}`,t.fillStyle=this.body.font.color.hex,t.textAlign=this.body.alignment,t.textBaseline="top";const e=new RegExp("\r\n","gi");let i=[];this.body.text.split(e).forEach((e,s)=>{0!=s&&i.push("");const o=e.split(" ");let n=[],h=0;o.forEach(e=>{const i=t.measureText(e).width,s=t.measureText(n[h]||"").width;this.body.padding.left+s+i+this.body.padding.right>l.MAX_WIDTH()&&h++;let o=n[h]||"";n[h]=o+=(o.length>0?" ":"")+e}),i.push(n)});let s=0;i.forEach(e=>{const o=t.measureText(e).width,n=this.x+(this._width-o)/2,h=this.y+(this._height-this.body.font.dimensions.height*i.length/2)/2;""!==e&&(t.fillText(e,n,h+this.body.font.dimensions.height*s),s++),a=o>a?o:a}),t.restore(),r=this.body.padding.top+i.length*this.body.font.dimensions.height+this.body.padding.bottom,a+=this.body.padding.left+this.body.padding.right}this._width=a>0?a:100,this._height=r>0?r:100,this._width=parseInt(this._width.toFixed(0))+r/2,this._height=parseInt(this._height.toFixed(0))+a/2,this.connections.forEach(e=>{e.draw(t)})}}class _{static MAX_SCALE(){return 2}static MIN_SCALE(){return.2}constructor({canvas:t,options:e,data:i}){this.isDrawing=!1,this.el=t||document.getElementById("canvas"),this.el.width=this.el.parentElement.clientWidth,this.el.height=this.el.parentElement.clientHeight,this.el.style.maxHeight="none",this.el.focus(),this.origin={x:0,y:0},this.data=i,this.options=e,this.intervalId=null,this.drawOrigin=e.drawOrigin||!1,this.background=e.background||{color:"rgb(255, 255, 255)"},this.scaleLimits={max:e.zoom.max||Canvas.MAX_SCALE(),min:e.zoom.min||Canvas.MIN_SCALE()},this.fps=e.fps||60,this.el.style.backgroundColor=this.background.color,this.scale={horizontal:1,vertical:1},this.setScale({horizontal:e.zoom.level||1,vertical:e.zoom.level||1}),this.canMoveBlocks=e.canMoveBlocks||!1;let s=!1,o=[],n=null,h=!1;this.el.addEventListener("mousemove",t=>{const{mxts:e,myts:i}=this.mousePosition(t);if(s)this.translate(t.movementX,t.movementY);else if(n)h=!0,n.x=parseInt((e-n._width/2).toFixed(0)),n.y=parseInt((i-n._height/2).toFixed(0));else for(let t=0;t<this.entitiesArray.length;t++){let s=this.entitiesArray[t];s.contains(e,i)?s._hover||(s._hover=!0,this.el.dispatchEvent(new CustomEvent("mouseenterentity",{detail:s}))):s._hover&&(s._hover=!1,this.el.dispatchEvent(new CustomEvent("mouseleaveentity",{detail:s})))}}),this.el.addEventListener("dblclick",t=>{const{mxts:e,myts:i}=this.mousePosition(t);this.addEntity(new x({x:e,y:i,header:{text:"Lorem ipsum dolor sit",alignment:"start",font:{family:"Times",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:25,weight:"bold"}},body:{text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at consectetur lorem. Etiam dignissim dolor sit amet orci efficitur auctor.",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}},footer:{text:"Lorem ipsum dolor sit",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}}}))}),this.el.addEventListener("click",t=>{const{mxts:e,myts:i}=this.mousePosition(t);if(h)h=!1;else{for(let t=0;t<this.entitiesArray.length;t++){let s=this.entitiesArray[t];if(s.contains(e,i)){if(s.emit("click"),s._selected=!0,this.el.dispatchEvent(s.createEvent("clickentity")),0===o.length?o.push(s):o.forEach(t=>{t._id!==s._id&&o.push(s)}),2==o.length){let t=o.pop(),e=o.pop(),i=!1;for(let s=0;s<e.connections.length;s++){if(e.connections[s].to._id===t._id){i=!0;break}}for(let s=0;s<t.connections.length;s++){if(t.connections[s].to._id===e._id){i=!0;break}}i||e.addConnection({to:t}),o=[]}return}s._selected=!1}o=[]}}),this.el.addEventListener("mousedown",t=>{const{mxts:e,myts:i}=this.mousePosition(t);for(let t=0;t<this.entitiesArray.length;t++){let s=this.entitiesArray[t];if(s.contains(e,i))return s._selected=!0,void(!n&&this.canMoveBlocks&&s.isDraggable&&(n=s))}s=!0}),this.el.addEventListener("mouseup",t=>{s=!1,n&&(n._selected=!1,n=null)}),this.el.addEventListener("mouseout",t=>{s=!1,o=[],n=null,h=!1}),this.el.addEventListener("wheel",t=>{t.wheelDelta>0?this.setScale({horizontal:1.01,vertical:1.01}):this.setScale({horizontal:.99,vertical:.99})});let r=null,a=null;this.el.addEventListener("touchstart",t=>{if(1===t.touches.length){const e=t.touches[0].clientX,i=t.touches[0].clientY,{mxts:o,myts:h}=this.mousePosition({x:e,y:i});for(let t=0;t<this.entitiesArray.length;t++){let e=this.entitiesArray[t];if(e.contains(o,h))return n||(n=e),void this.el.dispatchEvent(e.createEvent("touchstartentity"))}s=!0,a&&(t.timeStamp,a.timeStamp,t.timeStamp-a.timeStamp<=200&&this.el.dispatchEvent(new CustomEvent("dbtouch",t))),a=t}}),this.el.addEventListener("touchmove",t=>{if(1===t.touches.length){const e=t.touches[0].clientX,i=t.touches[0].clientY,{mxts:o,myts:a}=this.mousePosition({x:e,y:i});if(s&&r){const t=r.touches[0].clientX,e=r.touches[0].clientY;let i=this.mousePosition({x:t,y:e});i.mxts,i.myts;let s=(o-i.mxts)*this.scale.horizontal,n=(a-i.myts)*this.scale.vertical;this.translate(s,n)}else n&&(h=!0,n.x=o-n._width/2,n.y=a-n._height/2);r=t}}),this.el.addEventListener("touchend",t=>{n&&(n=null);const e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY,{mxts:o,myts:h}=this.mousePosition({x:e,y:i});for(let t=0;t<this.entitiesArray.length;t++){let e=this.entitiesArray[t];e.contains(o,h)&&this.el.dispatchEvent(e.createEvent("touchendentity"))}s=!1,r=null}),this._evCache=[],this.prevDiff=-1;const l=t=>{d(t),this._evCache.length<2&&(this.prevDiff=-1)},d=t=>{for(var e=0;e<this._evCache.length;e++)if(this._evCache[e].pointerId==t.pointerId){this._evCache.splice(e,1);break}};this.el.onpointerdown=t=>{this._evCache.push(t)},this.el.onpointermove=t=>{for(var e=0;e<this._evCache.length;e++)if(t.pointerId==this._evCache[e].pointerId){this._evCache[e]=t;break}if(2==this._evCache.length){var i=Math.abs(this._evCache[0].clientX-this._evCache[1].clientX);this.prevDiff>0&&(i>this.prevDiff&&this.setScale({horizontal:1.01,vertical:1.01}),i<this.prevDiff&&this.setScale({horizontal:.99,vertical:.99})),this.prevDiff=i}},this.el.onpointerup=l,this.el.onpointercancel=l,this.el.onpointerout=l,this.el.onpointerleave=l,window.addEventListener("resize",()=>{this.el.width=this.el.parentElement.clientWidth,this.el.height=this.el.parentElement.clientHeight},!1),this.start()}get ctx(){return this.el.getContext("2d")}get entitiesArray(){return Object.values(this.entities)}set data(t){this.entities={};let e={};if(t&&Object.values(t).length>0){for(let[i,s]of Object.entries(t))if(s){let t;t="conditional"===s.type?new m(s):new x(s),t.name=i,e[i]=t,this.addEntity(t)}for(let[i,s]of Object.entries(t))s&&s.connections&&s.connections.forEach(t=>{e[t.to]&&(t.to=e[t.to],e[i].addConnection(t))})}}getData(){let t={};const e=this.entitiesArray;for(let i=0;i<e.length;i++){const s=e[i],o={};o.type=s instanceof x?"block":"conditional",Object.keys(e[i]).forEach(t=>{"_"!==t.charAt(0)&&(o[t]=s[t])}),o.connections=[];for(let t=0;t<s.connections.length;t++){let e=s.connections[t],i={};Object.keys(e).forEach(t=>{"_"!==t.charAt(0)&&(i[t]=e[t])}),i.to=e.to.name,o.connections.push(i)}t[s.name]=o}return t}setScale({horizontal:t,vertical:e}){const i=this.scale.horizontal*t,s=this.scale.vertical*e;i<this.scaleLimits.max&&s<this.scaleLimits.max&&i>=this.scaleLimits.min&&s>=this.scaleLimits.min&&(this.scale.horizontal=i,this.scale.vertical=s)}addEntity(t){this.entities[t.name]=t}removeEntity(t){this.entitiesArray.forEach(e=>{e.removeConnection(t)}),delete this.entities[t.name]}clear(){this.ctx.clearRect(0,0,this.el.width,this.el.height)}translate(t,e){this.origin.x+=t,this.origin.y+=e}start(){this.intervalId=setInterval(()=>{this.clear(),this.ctx.save(),this.drawOrigin&&(this.ctx.lineWidth="1",this.ctx.strokeStyle="rgba(0,0,0,0.2)",this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x,this.origin.y+100*this.el.height),this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x+100*this.el.width,this.origin.y),this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x-100*this.el.width,this.origin.y),this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x,this.origin.y-100*this.el.height),this.ctx.stroke()),this.ctx.translate(this.origin.x+.5,this.origin.y+.5),this.ctx.scale(this.scale.horizontal,this.scale.vertical),Object.values(this.entities).forEach(t=>{t.draw(this.ctx)}),this.ctx.restore()},1e3/this.fps)}stop(){clearInterval(this.intervalId)}getEntities(){return a()(this.entities)}on(t,e){"onkeypress"===t||"onkeyup"===t||"onkeydown"===t?window[t]=e:this.el.addEventListener(t,e)}mousePosition(t){let e=this.el.getBoundingClientRect(),i=window.pageXOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop,o=e.top+s,n=e.left+i;return{mxts:(t.x-this.origin.x-n)/this.scale.horizontal,myts:(t.y-this.origin.y-o)/this.scale.vertical}}getEntityByName(t){return this.entities[t]}saveAsImage(t){var e=document.createElement("a");e.download=t+".png",e.href=canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),e.click()}}const b=()=>/Mobi|Android/i.test(navigator.userAgent)}])}));