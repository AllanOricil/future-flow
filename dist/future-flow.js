!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.futureFlow=i():t.futureFlow=i()}(window,(function(){return function(t){var i={};function e(s){if(i[s])return i[s].exports;var o=i[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)e.d(s,o,function(i){return t[i]}.bind(null,o));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=1)}([function(t,i){function e(t,i){var e=[],s=[];return null==i&&(i=function(t,i){return e[0]===i?"[Circular ~]":"[Circular ~."+s.slice(0,e.indexOf(i)).join(".")+"]"}),function(o,n){if(e.length>0){var r=e.indexOf(this);~r?e.splice(r+1):e.push(this),~r?s.splice(r,1/0,o):s.push(o),~e.indexOf(n)&&(n=i.call(this,o,n))}else e.push(n);return null==t?n:t.call(this,o,n)}}(t.exports=function(t,i,s,o){return JSON.stringify(t,e(i,o),s)}).getSerialize=e},function(t,i,e){"use strict";e.r(i),e.d(i,"Flow",(function(){return S})),e.d(i,"isMobile",(function(){return M}));class s{constructor(){this._entitiesMap=new Map,[...Array(100).keys()].forEach(t=>{this._entitiesMap.set(t,new Map)}),this._entitiesLayerMap=new Map}getLayer(t){return this._entitiesMap.get(t)}getEntityLayerByName(t){return this.getLayer(this._entitiesLayerMap.get(t))}getEntityByName(t){return this.getEntityLayerByName(t).get(t)}addEntity(t){this.getLayer(t._z).set(t._name,t),this._entitiesLayerMap.set(t._name,t._z)}removeEntityByName(t){const i=this.getEntityByName(t);return this.entities.forEach(t=>{t.removeConnection(i)}),this.getEntityLayerByName(t).delete(t)}clearLayer(t){const i=this.getLayer(t);i&&i.clear()}get entities(){let t=[];for(let[i,e]of this._entitiesMap.entries())e.forEach(i=>{t.push(i)});return t}}class o{constructor({x:t,y:i}){this._x=t,this._y=i}get x(){return parseInt(this._x.toFixed(0))}get y(){return parseInt(this._y.toFixed(0))}set x(t){this._x=t}set y(t){this._y=t}}class n{constructor({horizontal:t,vertical:i}){this._horizontal=t,this._vertical=i}get horizontal(){return this._horizontal}get vertical(){return this._vertical}set horizontal(t){this._horizontal=t}set vertical(t){this._vertical=t}}const r=function(t,i,e,s,o,n,r,h,a){return{x:Math.pow(1-t,3)*i+3*t*Math.pow(1-t,2)*s+3*t*t*(1-t)*n+t*t*t*h,y:Math.pow(1-t,3)*e+3*t*Math.pow(1-t,2)*o+3*t*t*(1-t)*r+t*t*t*a}},h=function(t,i,e,s,o,n,r){return{x:(1-t)*(1-t)*i+2*(1-t)*t*s+t*t*n,y:(1-t)*(1-t)*e+2*(1-t)*t*o+t*t*r}},a=function({startPoint:t,controlPoint1:i,controlPoint2:e,endPoint:s,numberOfPointsToGenerate:o}){let n=[],a=o||50;for(let o=0;o<=a;o++){let d=null;d=e?r(o/a,t.x,t.y,i.x,i.y,e.x,e.y,s.x,s.y):h(o/a,t.x,t.y,i.x,i.y,s.x,s.y),n.push(d)}return n};class d{constructor({angle:t,referential:i}){this._angle=t,this._referential=new o(i||{x:0,y:0})}get angle(){return this._angle}set angle(t){this._angle=t}get referential(){return this._referential}}const l=t=>t.replace(/\s/g,"");class c{static get htmlColors(){return{INDIANRED:"rgb(205, 92, 92)",LIGHTCORAL:"rgb(240, 128, 128)",SALMON:"rgb(250, 128, 114)",DARKSALMON:"rgb(233, 150, 122)",LIGHTSALMON:"rgb(255, 160, 122)",CRIMSON:"rgb(220, 20, 60)",RED:"rgb(255, 0, 0)",FIREBRICK:"rgb(178, 34, 34)",DARKRED:"rgb(139, 0, 0)",PINK:"rgb(255, 192, 203)",LIGHTPINK:"rgb(255, 182, 193)",HOTPINK:"rgb(255, 105, 180)",DEEPPINK:"rgb(255, 20, 147)",MEDIUMVIOLETRED:"rgb(199, 21, 133)",PALEVIOLETRED:"rgb(219, 112, 147)",LIGHTSALMON:"rgb(255, 160, 122)",CORAL:"rgb(255, 127, 80)",TOMATO:"rgb(255, 99, 71)",ORANGERED:"rgb(255, 69, 0)",DARKORANGE:"rgb(255, 140, 0)",ORANGE:"rgb(255, 165, 0)",GOLD:"rgb(255, 215, 0)",YELLOW:"rgb(255, 255, 0)",LIGHTYELLOW:"rgb(255, 255, 224)",LEMONCHIFFON:"rgb(255, 250, 205)",LIGHTGOLDENRODYELLOW:"rgb(250, 250, 210)",PAPAYAWHIP:"rgb(255, 239, 213)",MOCCASIN:"rgb(255, 228, 181)",PEACHPUFF:"rgb(255, 218, 185)",PALEGOLDENROD:"rgb(238, 232, 170)",KHAKI:"rgb(240, 230, 140)",DARKKHAKI:"rgb(189, 183, 107)",LAVENDER:"rgb(230, 230, 250)",THISTLE:"rgb(216, 191, 216)",PLUM:"rgb(221, 160, 221)",VIOLET:"rgb(238, 130, 238)",ORCHID:"rgb(218, 112, 214)",FUCHSIA:"rgb(255, 0, 255)",MAGENTA:"rgb(255, 0, 255)",MEDIUMORCHID:"rgb(186, 85, 211)",MEDIUMPURPLE:"rgb(147, 112, 219)",REBECCAPURPLE:"rgb(102, 51, 153)",BLUEVIOLET:"rgb(138, 43, 226)",DARKVIOLET:"rgb(148, 0, 211)",DARKORCHID:"rgb(153, 50, 204)",DARKMAGENTA:"rgb(139, 0, 139)",PURPLE:"rgb(128, 0, 128)",INDIGO:"rgb(75, 0, 130)",SLATEBLUE:"rgb(106, 90, 205)",DARKSLATEBLUE:"rgb(72, 61, 139)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",GREENYELLOW:"rgb(173, 255, 47)",CHARTREUSE:"rgb(127, 255, 0)",LAWNGREEN:"rgb(124, 252, 0)",LIME:"rgb(0, 255, 0)",LIMEGREEN:"rgb(50, 205, 50)",PALEGREEN:"rgb(152, 251, 152)",LIGHTGREEN:"rgb(144, 238, 144)",MEDIUMSPRINGGREEN:"rgb(0, 250, 154)",SPRINGGREEN:"rgb(0, 255, 127)",MEDIUMSEAGREEN:"rgb(60, 179, 113)",SEAGREEN:"rgb(46, 139, 87)",FORESTGREEN:"rgb(34, 139, 34)",GREEN:"rgb(0, 128, 0)",DARKGREEN:"rgb(0, 100, 0)",YELLOWGREEN:"rgb(154, 205, 50)",OLIVEDRAB:"rgb(107, 142, 35)",OLIVE:"rgb(128, 128, 0)",DARKOLIVEGREEN:"rgb(85, 107, 47)",MEDIUMAQUAMARINE:"rgb(102, 205, 170)",DARKSEAGREEN:"rgb(143, 188, 139)",LIGHTSEAGREEN:"rgb(32, 178, 170)",DARKCYAN:"rgb(0, 139, 139)",TEAL:"rgb(0, 128, 128)",AQUA:"rgb(0, 255, 255)",CYAN:"rgb(0, 255, 255)",LIGHTCYAN:"rgb(224, 255, 255)",PALETURQUOISE:"rgb(175, 238, 238)",AQUAMARINE:"rgb(127, 255, 212)",TURQUOISE:"rgb(64, 224, 208)",MEDIUMTURQUOISE:"rgb(72, 209, 204)",DARKTURQUOISE:"rgb(0, 206, 209)",CADETBLUE:"rgb(95, 158, 160)",STEELBLUE:"rgb(70, 130, 180)",LIGHTSTEELBLUE:"rgb(176, 196, 222)",POWDERBLUE:"rgb(176, 224, 230)",LIGHTBLUE:"rgb(173, 216, 230)",SKYBLUE:"rgb(135, 206, 235)",LIGHTSKYBLUE:"rgb(135, 206, 250)",DEEPSKYBLUE:"rgb(0, 191, 255)",DODGERBLUE:"rgb(30, 144, 255)",CORNFLOWERBLUE:"rgb(100, 149, 237)",MEDIUMSLATEBLUE:"rgb(123, 104, 238)",ROYALBLUE:"rgb(65, 105, 225)",BLUE:"rgb(0, 0, 255)",MEDIUMBLUE:"rgb(0, 0, 205)",DARKBLUE:"rgb(0, 0, 139)",NAVY:"rgb(0, 0, 128)",MIDNIGHTBLUE:"rgb(25, 25, 112)",CORNSILK:"rgb(255, 248, 220)",BLANCHEDALMOND:"rgb(255, 235, 205)",BISQUE:"rgb(255, 228, 196)",NAVAJOWHITE:"rgb(255, 222, 173)",WHEAT:"rgb(245, 222, 179)",BURLYWOOD:"rgb(222, 184, 135)",TAN:"rgb(210, 180, 140)",ROSYBROWN:"rgb(188, 143, 143)",SANDYBROWN:"rgb(244, 164, 96)",GOLDENROD:"rgb(218, 165, 32)",DARKGOLDENROD:"rgb(184, 134, 11)",PERU:"rgb(205, 133, 63)",CHOCOLATE:"rgb(210, 105, 30)",SADDLEBROWN:"rgb(139, 69, 19)",SIENNA:"rgb(160, 82, 45)",BROWN:"rgb(165, 42, 42)",MAROON:"rgb(128, 0, 0)",WHITE:"rgb(255, 255, 255)",SNOW:"rgb(255, 250, 250)",HONEYDEW:"rgb(240, 255, 240)",MINTCREAM:"rgb(245, 255, 250)",AZURE:"rgb(240, 255, 255)",ALICEBLUE:"rgb(240, 248, 255)",GHOSTWHITE:"rgb(248, 248, 255)",WHITESMOKE:"rgb(245, 245, 245)",SEASHELL:"rgb(255, 245, 238)",BEIGE:"rgb(245, 245, 220)",OLDLACE:"rgb(253, 245, 230)",FLORALWHITE:"rgb(255, 250, 240)",IVORY:"rgb(255, 255, 240)",ANTIQUEWHITE:"rgb(250, 235, 215)",LINEN:"rgb(250, 240, 230)",LAVENDERBLUSH:"rgb(255, 240, 245)",MISTYROSE:"rgb(255, 228, 225)",GAINSBORO:"rgb(220, 220, 220)",LIGHTGRAY:"rgb(211, 211, 211)",SILVER:"rgb(192, 192, 192)",DARKGRAY:"rgb(169, 169, 169)",GRAY:"rgb(128, 128, 128)",DIMGRAY:"rgb(105, 105, 105)",LIGHTSLATEGRAY:"rgb(119, 136, 153)",SLATEGRAY:"rgb(112, 128, 144)",DARKSLATEGRAY:"rgb(47, 79, 79)",BLACK:"rgb(0, 0, 0)"}}static rgbRegex(){return new RegExp("rgb\\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3}\\)|rgba\\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3},(([0]*?.d*)|1|0)\\)","gi")}static rgbaRegex(){return new RegExp("rgb\\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3}\\)|rgba\\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3},(([0]*?.d*)|1|0)\\)","gi")}static hexRegex(){return new RegExp("^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$","gi")}static isRGB(t){return null!==l(t).match(c.rgbRegex())}static isRGBA(t){return null!==l(t).match(c.rgbaRegex())}static isHEX(t){return null!==l(t).match(c.hexRegex())}static string2Color(t){const i=c.htmlColors[t.toUpperCase()];if(i&&(t=i),c.isRGB(t)||c.isRGBA(t)){let i=l(t).replace("rgb(","").replace("rgba(","").replace(")","").split(",");return{red:i[0],green:i[1],blue:i[2],alpha:i[3]||1}}if(c.isHEX(t)){const i=(t=l(t).replace("#","")).length/3;return{red:parseInt(t.substring(0,i),16),green:parseInt(t.substring(i,2*i),16),blue:parseInt(t.substring(2*i,3*i),16),alpha:1}}return{red:0,green:0,blue:0,alpha:1}}static rgbToHex(t){const i=(t=t.replace(/\s/g,"")).replace("rgb(","").replace("rgba(","").replace(")","").split(",");let e="#";return i.forEach((t,i)=>{if(3!=i){const i=Number(t).toString(16);e+=2===i.length?i:"0"+i}}),e}constructor(t){"string"==typeof t&&(t=c.string2Color(t)),this._red=t.red,this._green=t.green,this._blue=t.blue,this._alpha=t.alpha||1}get rgb(){return`rgb(${this._red},${this._green},${this._blue})`}get rgba(){return`rgba(${this._red},${this._green},${this._blue},${this._alpha})`}get hex(){return c.rgbToHex(this.rgb)}}class g{constructor({radius:t,color:i,lineWidth:e,selected:s,hover:o}){this._radius=t,this._lineWidth=e,this._color=i?new c(i):null,this._selected=s?new g({lineWidth:s.lineWidth,color:s.color}):null,this._hover=o?new g({lineWidth:o.lineWidth,color:o.color}):null}get radius(){return this._radius}set radius(t){this._radius=t}get color(){return this._color}set color(t){this._color=new c(t)}get selected(){return this._selected}get hover(){return this._hover}get lineWidth(){return this._lineWidth}}class _{constructor({offsetX:t,offsetY:i,color:e,blur:s}){this._offsetX=t,this._offsetY=i,this._color=new c(e),this._blur=s}get offsetX(){return this._offsetX}get offsetY(){return this._offsetY}get color(){return this._color}get blur(){return this._blur}}class p{static get POSITION(){return{x:0,y:0}}static get DIMENSION(){return{width:0,height:0}}static get ROTATION(){return{angle:0}}static get SCALE(){return{horizontal:1,vertical:1}}constructor({position:t,dimension:i,rotation:e,scale:s}){this._position=t||p.POSITION,this._dimension=i||p.DIMENSION,this._rotation=e?new d(e):p.ROTATION,this._scale=s?new n(s):p.SCALE}get position(){return this._position}get dimension(){return this._dimension}get rotation(){return this._rotation}get scale(){return this._scale}}class m{constructor({src:t,position:i,dimension:e,rotation:s,scale:o}){this._transform=new p({position:i,dimension:e,rotation:s,scale:o}),this._image=new m(this._tranform.dimension.width,this._transform.dimension.height),this._src=t,this._image.src=this._src,this._image.addEventListener("load",()=>{this._loaded=!0}),this._loaded=!1}set src(t){this._src=t}get transfor(){return this._transform}}class f{constructor({color:t,image:i}){this._color=t?new c(t):null,this._image=i?new m({image:i}):null}get color(){return this._color}get image(){return this._image}}class u{static get ROTATION(){return{angle:0}}static get BACKGROUND(){return{color:"rgb(255,255,255)"}}static get SHADOW(){return{offsetX:0,offsetY:0,color:"rgb(0,0,0)",blur:0}}static get BORDER(){return{radius:5,lineWidth:1,color:"black",selected:{lineWidth:1,color:"black"},hover:{lineWidth:1,color:"black"}}}constructor({position:t,dimension:i,rotation:e,scale:s,background:o,border:n,shadow:r}){this._transform=new p({position:t,dimension:i,rotation:e,scale:s}),this._border=n?"Border"==typeof n?n:new g(n):u.BORDER,this._background=o?"Background"==typeof o?o:new f(o):u.BACKGROUND,this._shadow=r?"Shadow"==typeof r?r:new _(r):u.SHADOW,this._path=null}draw(t){this._shadow&&(t.shadowColor=this._shadow.color.hex,t.shadowBlur=this._shadow.blur,t.shadowOffsetX=this._shadow.offsetX,t.shadowOffsetY=this._shadow.offsetY),t.strokeStyle=this._border.color.hex,t.fillStyle=this._background.color.hex,t.lineWidth=this._border.width}rotateFromPosition(t,i){t.translate(i.x,i.y),t.rotate(this._transform.rotation.angle),t.translate(-i.x,-i.y)}get sides(){const t=this._transform.dimension.width/2,i=this._transform.dimension.height/2;return{top:{x:this._transform.position.x+t,y:this._transform.position.y},right:{x:this._transform.position.x+this._transform.dimension.width,y:this._transform.position.y+i},bottom:{x:this._transform.position.x+t,y:this._transform.position.y+this._transform.dimension.height},left:{x:this._transform.position.x,y:this._transform.position.y+i}}}get path(){return this._path}set path(t){this._path=t}get border(){return this._border}get background(){return this._background}get rotation(){return this._transform.rotation}get shadow(){return this._shadow}set rotation(t){this._transform.rotation.angle=t}get position(){return this._transform.position}set position(t){this._transform.position.x=t.x,this._transform.position.y=t.y}}class b extends u{constructor({position:t,dimension:i,rotation:e,border:s,background:o,shadow:n}){super({position:t,dimension:i,rotation:e,border:s,background:o,shadow:n})}draw(t){t.save(),super.draw(t),this.rotateFromPosition(t,{x:this._transform.position.x,y:this._transform.position.y}),this._path=new Path2D,t.beginPath(),this._path.moveTo(this._transform.position.x,this._transform.position.y),this._path.lineTo(this._transform.position.x-this._transform.dimension.width,this._transform.position.y-this._transform.dimension.height/2),this._path.lineTo(this._transform.position.x-this._transform.dimension.width,this._transform.position.y+this._transform.dimension.height/2),this._path.closePath(),t.stroke(this._path),t.fill(this._path),t.shadowColor=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.stroke(this._path),t.restore()}}class y extends u{constructor({position:t,rotation:i,border:e,background:s,diameter:o,shadow:n}){super({position:t,rotation:i,border:e,background:s,shadow:n}),this._diameter=o}draw(t){t.save(),super.draw(t),this.rotateFromPosition(t,{x:this._position.x,y:this._position.y}),t.beginPath(),this._path=new Path2D,this._path.arc(this.position.x,this.position.y,this._diameter,0,2*Math.PI),this._path.closePath(),t.stroke(this._path),t.fill(this._path),t.shadowColor=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.stroke(this._path),t.restore()}}class x{constructor({shape:t,position:i,color:e,fillColor:s,rotation:n,diameter:r,dimension:h}){this._shape="triangle"===t?new b({position:new o(i),dimension:h,rotation:n,border:{color:e},background:{color:s}}):new y({position:new o(i),rotation:n,diameter:r,color:e,fillColor:s})}draw(t){this._shape.draw(t)}get shape(){return this._shape}}class E{constructor({weight:t,color:i,enableBezierCurves:e,dashed:s}){this._weight=t,this._color=new c(i),this._enableBezierCurves=e,this._dashed=s}get weight(){return this._weight}get color(){return this._color}get enableBezierCurves(){return this._enableBezierCurves}get dashed(){return this._dashed}}class w{static FLOW_SPEED(){return 1}static FLOW_TYPE(){return"circle"}static PARTICLE_FILL_COLOR(){return"rgb(212, 212, 212)"}static FLOW_PARTICLE_DISTANCE(){return 5}constructor({from:t,to:i,line:e,connector:s,isEditable:o,animation:n,showPathPoints:r}){this._from=t,this._to=i,this.line=new E(e),s.position=i.position,this._connector=new x(s),this.isEditable=o,this._particles=[],this._animationStarted=!1,this._flow=!0,this.showPathPoints=!1,this._oldToDimensions={width:this._to._width,height:this._to._height},this._oldFromDimensions={width:this._from.width,height:this._from.height},this._pathPoints=[],n&&(this.animation={speed:n.speed||w.FLOW_SPEED(),fillColor:n.fillColor||w.PARTICLE_FILL_COLOR(),type:n.type||w.FLOW_TYPE(),particleDistance:n.particleDistance||w.FLOW_PARTICLE_DISTANCE()})}get connectionPoints(){let t=1/0,i={};for(let[e,s]of Object.entries(this._from.shape.sides))for(let[o,n]of Object.entries(this._to.shape.sides)){const r=Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2));r<t&&(t=r,s.name=e,n.name=o,i={origin:s,destination:n})}return i}createPath(){const t=this.connectionPoints,i=t.origin,e=t.destination;let s=Math.abs(e.x-i.x)/2,o=Math.abs(e.y-i.y)/2,n=[];return"left"===i.name&&"right"===e.name||"right"===i.name&&"left"===e.name?(i.x>e.x&&(s*=-1),n.push({x:i.x,y:i.y},{x:i.x+s,y:i.y},{x:e.x-s,y:e.y},{x:e.x,y:e.y})):"bottom"!==i.name&&"top"!==i.name||"right"!==e.name&&"left"!==e.name?"right"!==i.name&&"left"!==i.name||"top"!==e.name&&"bottom"!==e.name?("top"===i.name&&"bottom"===e.name||"bottom"===i.name&&"top"===e.name)&&(i.y>e.y&&(o*=-1),n.push({x:i.x,y:i.y},{x:i.x,y:i.y+o},{x:e.x,y:e.y-o},{x:e.x,y:e.y})):n.push({x:i.x,y:i.y},{x:e.x,y:i.y},{x:e.x,y:e.y}):n.push({x:i.x,y:i.y},{x:i.x,y:e.y},{x:e.x,y:e.y}),n}draw(t){let i=this.createPath();if(i.length>0){t.save(),t.lineWidth=this.line.weight,t.strokeStyle=this.line.color.hex,t.setLineDash(this.line.dashed),t.lineWidth=this.line.weight,t.lineCap="square",t.beginPath();const e=i[0];if(t.moveTo(e.x,e.y),this.line&&this.line.enableBezierCurves)if(3===i.length){const s=i[1],o=i[2];this._pathPoints=a({startPoint:e,controlPoint1:s,endPoint:o}),t.quadraticCurveTo(s.x,s.y,o.x,o.y)}else{const s=i[1],o=i[2],n=i[3];this._pathPoints=a({startPoint:e,controlPoint1:s,controlPoint2:o,endPoint:n}),t.bezierCurveTo(s.x,s.y,o.x,o.y,n.x,n.y)}else{this._pathPoints=function(t){let i=[];for(let e=1;e<t.length;e++){const s=t[e];if(s.x===t[e-1].x){const o=(s.y-t[e-1].y)/50;for(let n=0;n<50;n++)i.push({x:s.x,y:t[e-1].y+o*n})}else if(s.y===t[e-1].y){const o=(s.x-t[e-1].x)/50;for(let n=0;n<50;n++)i.push({x:t[e-1].x+o*n,y:s.y})}}return i.push({x:t[t.length-1].x,y:t[t.length-1].y}),i}(i);for(let e=1;e<i.length;e++){const s=i[e];t.lineTo(s.x,s.y)}}if(t.stroke(),t.closePath(),t.restore(),this.showPathPoints&&this._pathPoints.length){t.save(),t.fillStyle="red";for(let i=0;i<this._pathPoints.length-1;i++)t.beginPath(),t.arc(this._pathPoints[i].x,this._pathPoints[i].y,1,0,2*Math.PI),t.fill();t.restore()}if(t.save(),this.animation&&this._animationStarted){0===this._particles.length&&this.addParticle();for(let i=0;i<this._particles.length;i++){let e=this._particles[i];this._pathPoints.length&&(e.toIndex>this.animation.particleDistance&&!e.addedParticle&&this._flow&&(this.addParticle(),e.addedParticle=!0),e.toIndex++,e.toIndex>=this._pathPoints.length?this.removeParticle():(e.x=e.to.x,e.y=e.to.y,e.to=this._pathPoints[e.toIndex])),t.beginPath(),t.fillStyle=this.animation.fillColor,t.moveTo(e.x,e.y),"circle"===this.animation.type&&t.arc(e.x,e.y,5,0,2*Math.PI),t.fill(),t.closePath()}}t.restore();const s=i[i.length-1],o=i[i.length-2],n=s.x-o.x,r=s.y-o.y;this._connector.shape.rotation=Math.atan2(r,n),this._connector.shape.position=s,this._connector.draw(t)}}addParticle(){this._particles.push({x:this._pathPoints[0].x,y:this._pathPoints[0].y,toIndex:1,to:this._pathPoints[1],addedParticle:!1})}removeParticle(){this._particles.splice(0,1)}startAnimation(){this._animationStarted=!0}stopAnimation(){this._particles=[],this._animationStarted=!1}restartAnimation(){this.stopAnimation(),this.startAnimation()}endFlow(){this._flow=!1}get to(){return this._to}get from(){return this._from}}var v=e(0),A=e.n(v);class L{constructor({top:t,right:i,bottom:e,left:s}){this._top=t,this._right=i,this._bottom=e,this._left=s}get top(){return this._top}get right(){return this._right}get bottom(){return this._bottom}get left(){return this._left}set top(t){this._top=t}set right(t){this._right=t}set bottom(t){this._bottom=t}set left(t){this._left=t}}class I extends class{constructor(){this.callbacks={}}on(t,i){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(i)}emit(t,i){let e=this.callbacks[t];e&&e.forEach(t=>t(i))}}{static get MAX_WIDTH(){return 350}static get PADDING(){return{top:15,right:15,bottom:15,left:15}}constructor({name:t,padding:i,dimension:e,position:s,parent:n},r){super(),this._id=+new Date+1e5*Math.random(),this.name=t,this._name=t,this.connections=[],this._selected=!1,this._hover=!1,this._z=0,this._transform=new p({position:s,dimension:e}),this._oldPosition=new o(s),this._padding=i?"Padding"==typeof i?i:new L(i):I.PADDING,this._parent=n,this._children=[],this._canvas=r}update(t){}createEvent(t){return new CustomEvent(t,{detail:this})}addConnection(t){t.from=this;const i=new w(t);this.connections.push(i)}contains(){return this._canvas.ctx.isPointInPath(this._shape.path,this._canvas.mouse.x,this._canvas.mouse.y,"nonzero")}startAnimation(t){this.getConnection(t).startAnimation()}startAllAnimations(){this.connections.forEach(t=>{t.startAnimation()})}finishAllAnimations(){this.connections.forEach(t=>{t.finishAnimation()})}stopAnimation(t){this.getConnection(t).stopAnimation()}finishAnimation(t){this.getConnection(t).finishAnimation()}getConnection(t){return this.connections.find(i=>i.to.name===t.name)}getConnectionByName(t){return this.connections.find(i=>i.to.name===t)}removeConnection(t){for(let i=0;i<this.connections.length;i++)if(this.connections[i].to.name===t.name)return void this.connections.splice(i,1)}toString(){let t=[];return this.connections.forEach(i=>{t.push({id:i.to.id,name:i.to.name})}),A()({id:this._id,name:this.name,position:{x:this._position.x,y:this._position.y},connections:t,content:{header:this.header?this.header.text:null,body:this.body?this.body.text:null,footer:this.footer?this.footer.text:null}},null,4)}prettier(){return"string"!=typeof(t=this.toString())&&(t=JSON.stringify(t,void 0,2)),(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(function(t){var i="number";return/^"/.test(t)?i=/:$/.test(t)?"key":"string":/true|false/.test(t)?i="boolean":/null/.test(t)&&(i="null"),'<span class="'+i+'">'+t+"</span>"}));var t}set state(t){this.states.includes(t)&&this.emit(t,{detail:this})}get shape(){return this._shape}get padding(){return this._padding}get dimension(){return this._transform.dimension}get position(){return this._transform.position}get children(){return this._children}get parent(){return this._parent}set position(t){this._oldPosition=new o(this._transform.position),this._transform.position.x=t.x,this._transform.position.y=t.y}get oldPosition(){return this._oldPosition}}class T{constructor({family:t,style:i,variant:e,color:s,size:o,weight:n}){this._family=t,this._style=i,this._variant=e,this._color=new c(s),this._size=o,this._weight=n,this._setFontDimensions()}set family(t){this._family=t,this._setFontDimensions()}set fontSize(t){this._fontSize=t,this._setFontDimensions()}set fontWeight(t){this._fontSize=t,this._setFontDimensions()}get font2Canvas(){return`${this._style} ${this._variant} ${this._weight} ${this._size}px ${this._family}`}get family(){return this._family}get style(){return this._style}get variant(){return this._variant}get color(){return this._color}get size(){return this._size}get weight(){return this._weight}get dimensions(){return this._dimensions}_setFontDimensions(){this._dimensions=function({fontFamily:t,fontSize:i,fontWeight:e,element:s}){const o=s||document.body;var n=document.createElement("span");n.innerHTML="Hg",n.setAttribute("style",`font-family: ${t} !important; font-size: ${i}px !important; font-weight:${e} !important;`);var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.height="0px";var h=document.createElement("div");h.appendChild(n),h.appendChild(r),o.appendChild(h);try{var a={};r.style.verticalAlign="baseline",a.ascent=r.offsetTop-n.offsetTop,r.style.verticalAlign="bottom",a.height=r.offsetTop-n.offsetTop,a.descent=a.height-a.ascent}finally{h.remove()}return a}({fontFamily:this._family,fontSize:this._size,fontWeight:this._weight})}}class O extends u{constructor({position:t,dimension:i,rotation:e,border:s,background:o,shadow:n}){super({position:t,dimension:i,rotation:e,border:s,background:o,shadow:n})}draw(t){t.save(),super.draw(t),this.rotateFromPosition(t,{x:this._transform.position.x+this._transform.dimension.width/2,y:this._transform.position.y+this._transform.dimension.height/2}),this._path=new Path2D,t.beginPath(),this._path.moveTo(this.sides.top.x-this._border.radius,this.sides.top.y+this._border.radius),this._path.quadraticCurveTo(this.sides.top.x,this.sides.top.y+.5*this._border.radius,this.sides.top.x+this._border.radius,this.sides.top.y+this._border.radius),this._path.lineTo(this.sides.right.x-this._border.radius,this.sides.right.y-this._border.radius),this._path.quadraticCurveTo(this.sides.right.x,this.sides.right.y,this.sides.right.x-this._border.radius,this.sides.right.y+this._border.radius),this._path.lineTo(this.sides.bottom.x+this._border.radius,this.sides.bottom.y-this._border.radius),this._path.quadraticCurveTo(this.sides.bottom.x,this.sides.bottom.y-.5*this._border.radius,this.sides.bottom.x-this._border.radius,this.sides.bottom.y-this._border.radius),this._path.lineTo(this.sides.left.x+this._border.radius,this.sides.left.y+this._border.radius),this._path.quadraticCurveTo(this.sides.left.x,this.sides.left.y,this.sides.left.x+this._border.radius,this.sides.left.y-this._border.radius),this._path.lineTo(this.sides.top.x-this._border.radius,this.sides.top.y+this._border.radius),this._path.closePath(),t.stroke(this._path),t.fill(this._path),t.shadowColor=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.stroke(this._path),t.restore()}}class D extends I{constructor({position:t,name:i,isDraggable:e,background:s,shadow:o,border:n,body:r,state:h,states:a},d){super({name:i,position:t},d),this.isDraggable=e||!1,this.states=a||[],this.state=h,r&&(this.body=r,this.body.font=new T(r.font),this.body.padding=r.padding?new L(r.padding):I.PADDING),this._shape=new O({position:this.position,dimension:this.dimension,shadow:o,border:n,background:s}),this.on("mouseenter",()=>{this._hover=!0}),this.on("mouseleave",()=>{this._hover=!1})}draw(t){this._shape.draw(t);let i=0,e=0;if(this.body){t.save(),t.font=`${this.body.font.style} ${this.body.font.variant} ${this.body.font.weight} ${this.body.font.size}px ${this.body.font.family}`,t.fillStyle=this.body.font.color.hex,t.textAlign=this.body.alignment,t.textBaseline="top";const s=new RegExp("\r\n","gi");let o=[];this.body.text.split(s).forEach((i,e)=>{0!=e&&o.push("");const s=i.split(" ");let n=[],r=0;s.forEach(i=>{const e=t.measureText(i).width,s=t.measureText(n[r]||"").width;this.body.padding.left+s+e+this.body.padding.right>I.MAX_WIDTH&&r++;let o=n[r]||"";n[r]=o+=(o.length>0?" ":"")+i}),o.push(n)});let n=0;o.forEach(i=>{const s=t.measureText(i).width,r=this.position.x+(this.dimension.width-s)/2,h=this.position.y+(this.dimension.height-this.body.font.dimensions.height*o.length/2)/2;""!==i&&(t.fillText(i,r,h+this.body.font.dimensions.height*n),n++),e=s>e?s:e}),t.restore(),i=this.body.padding.top+o.length*this.body.font.dimensions.height+this.body.padding.bottom,e+=this.body.padding.left+this.body.padding.right}this.dimension.width=parseInt(e.toFixed(0))+i/2,this.dimension.height=parseInt(i.toFixed(0))+e/2,this.connections.forEach(i=>{i.draw(t)})}}class P extends I{constructor({src:t,position:i,padding:e,dimension:s,parent:o}){super({position:i,padding:e,dimension:s,parent:o}),this._loaded=!1,this._image=new Image,this._image.src=t,this._image.addEventListener("load",()=>{this._loaded=!0})}get image(){return this._image}get loaded(){return this._loaded}draw(t){t.drawImage(this.image,this.parent.x+this.position.x+this.padding.left,this.parent.y+this.position.y+this.padding.top,this.dimension.width,this.dimension.height)}}class R extends u{constructor({position:t,dimension:i,rotation:e,border:s,background:o,shadow:n}){super({position:t,dimension:i,rotation:e,border:s,background:o,shadow:n})}draw(t){t.save(),super.draw(t),this.rotateFromPosition(t,{x:this._transform.position.x+this._transform.dimension.width/2,y:this._transform.position.y+this._transform.dimension.height/2}),this._path=new Path2D;var i=this._transform.position.x+this._transform.dimension.width,e=this._transform.position.y+this._transform.dimension.height;t.beginPath(),this._path.moveTo(this._transform.position.x+this._border.radius,this._transform.position.y),this._path.lineTo(i-this._border.radius,this._transform.position.y),this._path.quadraticCurveTo(i,this._transform.position.y,i,this._transform.position.y+this._border.radius),this._path.lineTo(i,this._transform.position.y+this._transform.dimension.height-this._border.radius),this._path.quadraticCurveTo(i,e,i-this._border.radius,e),this._path.lineTo(this._transform.position.x+this._border.radius,e),this._path.quadraticCurveTo(this._transform.position.x,e,this._transform.position.x,e-this._border.radius),this._path.lineTo(this._transform.position.x,this._transform.position.y+this._border.radius),this._path.quadraticCurveTo(this._transform.position.x,this._transform.position.y,this._transform.position.x+this._border.radius,this._transform.position.y),this._path.closePath(),t.stroke(this._path),t.fill(this._path),t.shadowColor=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.stroke(this._path),t.restore()}get area(){return this._transform.dimension.width*this._transform.dimension.height}get center(){return{x:this._transform.position.x+this._transform.dimension.width/2,y:this._transform.position.y+this._transform.dimension.height/2}}}class C extends I{constructor({position:t,name:i,isDraggable:e,background:s,shadow:o,border:n,header:r,body:h,padding:a,footer:d,state:l,states:c},g){super({name:i,position:t,padding:a},g),this.isDraggable=e||!1,this.states=c||[],this.state=l,r&&(this.header=r,this.header.font=new T(r.font),this.header.padding=r.padding?new L(r.padding):I.PADDING,this.header.icon=r.icon?new P({src:r.icon.src,parent:this,position:r.icon.position||{x:0,y:0},padding:r.icon.padding||I.PADDING,dimension:{width:25,height:25}}):{parent:this,position:{x:0,y:0},padding:{top:15,right:15,bottom:15,left:15},dimension:{width:25,height:25}}),h&&(this.body=h,this.body.font=new T(h.font),this.body.padding=h.padding?new L(h.padding):I.PADDING),d&&(this.footer=d,this.footer.font=new T(d.font),this.footer.padding=d.padding?new L(d.padding):I.PADDING),this._shape=new R({position:this.position,dimension:this.dimension,shadow:o,border:n,background:s}),this.on("mouseenter",()=>{this._hover=!0}),this.on("mouseleave",()=>{this._hover=!1})}draw(t){this._shape.draw(t);let i=0,e=0;if(this.header){let s;t.textBaseline="top",t.font=`${this.header.font.style} ${this.header.font.variant} ${this.header.font.weight} ${this.header.font.size}px ${this.header.font.family}`,t.fillStyle=this.header.font.color.hex,t.textAlign=this.header.alignment,this.header.icon&&this.header.font.dimensions.ascent<this.header.icon.dimension.height?(i=this.header.icon.padding.top+this.header.icon.dimension.height+this.header.icon.padding.bottom,s=(i-this.header.font.dimensions.ascent)/2):(i=this.header.padding.top+this.header.font.dimensions.ascent+this.header.padding.bottom,s=this.header.padding.top);let o=0;o="center"===this.header.alignment?this.position.x+this.dimension.width/2:this.header.icon?this.position.x+this.header.icon.dimension.width+this.header.icon.padding.left+this.header.icon.padding.right+this.header.padding.left:this.position.x+this.header.padding.left,t.fillText(this.header.text,o,this.position.y+s),this.header.divider&&(t.save(),t.strokeStyle=this.header.divider.color,t.lineWidth=this.header.divider.width,t.beginPath(),t.moveTo(this.position.x,this.position.y+i),t.lineTo(this.position.x+this.dimension.width,this.position.y+i),t.stroke(),t.closePath(),t.restore()),e=this.header.icon.dimension.width+this.header.icon.padding.left+this.header.icon.padding.right+t.measureText(this.header.text).width+this.header.padding.left+this.header.padding.right,this.header.icon&&this.header.icon.loaded&&this.header.icon.draw(t)}let s=0,o=0;if(this.body){t.save(),t.font=this.body.font.font2Canvas,t.fillStyle=this.body.font.color.hex,t.textAlign=this.body.alignment,t.textBaseline="top";let e=[];const n=this.body.text.split(" ");let r=0;n.forEach(i=>{const s=t.measureText(i).width,o=t.measureText(e[r]||"").width;this.body.padding.left+o+s+this.body.padding.right>I.MAX_WIDTH&&r++;let n=e[r]||"";e[r]=n+=(n.length>0?" ":"")+i}),e.forEach((e,s)=>{const n=this.position.y+i+this.body.font.dimensions.height*s+this.body.padding.top;t.fillText(e,this.position.x+this.body.padding.left,n);const r=t.measureText(e).width;o=r>o?r:o}),s=this.body.padding.top+e.length*this.body.font.dimensions.height+this.body.padding.bottom,o+=this.body.padding.left+this.body.padding.right,t.restore()}let n=0,r=0;this.footer&&(this.footer.divider&&(t.save(),t.strokeStyle=this.footer.divider.color,t.lineWidth=this.footer.divider.width,t.beginPath(),t.moveTo(this.position.x,this.position.y+i+s),t.lineTo(this.position.x+this.dimension.width,this.position.y+i+s),t.stroke(),t.closePath(),t.restore()),t.textBaseline="top",t.font=`${this.footer.font.style} ${this.footer.font.variant} ${this.footer.font.weight} ${this.footer.font.size}px ${this.footer.font.family}`,t.fillStyle=this.footer.font.color.hex,t.textAlign=this.footer.alignment,t.alignment="top",t.fillText(this.footer.text,this.position.x+this.footer.padding.left,this.position.y+i+s+this.footer.padding.top),n=this.footer.padding.top+this.footer.font.dimensions.height+this.footer.padding.bottom,r=this.footer.padding.left+t.measureText(this.footer.text).width+this.footer.padding.right);const h=(e>o&&e>r?e:o>r?o:r).toFixed(0),a=(i+s+n).toFixed(0);this.dimension.width=parseInt(h),this.dimension.height=parseInt(a),this.connections.forEach(i=>{i.draw(t)})}}class N{static get SCALE(){return{horizontal:1,vertical:1}}static get SCALELIMITS(){return{max:2,min:.2}}static get BACKGROUND(){return"transparent"}static get FPS(){return 60}static get CANMOVEBLOCKS(){return!0}static get CANDRAGCANVAS(){return!0}constructor({data:t,options:i,canvas:e}){this._entityManager=new s,this._dpi=window.devicePixelRatio,this._el=e||document.getElementById("canvas"),this._el.style.maxHeight="none",this._el.focus(),this._el.style.backgroundColor=i&&i.background?i.background.color:N.BACKGROUND,this._fps=i&&i.fps?i.fps:N.FPS,this._canMoveBlocks=i&&i.canMoveBlocks?i.canMoveBlocks:N.CANMOVEBLOCKS,this._canDragCanvas=i&&i.canDragCanvas?i.canDragCanvas:N.CANDRAGCANVAS,this._mouse=new o({x:0,y:0}),this._scaleLimits=i&&i.zoom?{max:i.zoom.max,min:i.zoom.min}:N.SCALELIMITS,this._transform=new p({position:{x:0,y:0},dimension:{width:this._el.parentElement.clientWidth,height:this._el.parentElement.clientHeight},scale:{horizontal:i.zoom.level,vertical:i.zoom.level}}),this._el.width=this._el.parentElement.clientWidth,this._el.height=this._el.parentElement.clientHeight,this._el.setAttribute("width",this._el.parentElement.clientWidth),this._el.setAttribute("height",this._el.parentElement.clientHeight),"undefined"!=typeof OffscreenCanvas?("OffscreenCanvas"in window?this._offscreenCanvas=this._el.transferControlToOffscreen():this._offscreenCanvas=new OffscreenCanvas(this._transform.dimension.width,this._transform.dimension.height),this._ctx=this._offscreenCanvas.getContext("2d")):this._ctx=this._el.getContext("2d"),this.setData(t),this._tickTime,this._updateTime,this._drawTime;let n=!1,r=[],h=null,a=!1,d=null;this._el.addEventListener("mousemove",t=>{const{x:i,y:e}=this.mousePosition(t);if(this._mouse.x=i,this._mouse.y=e,n)return this._el.style.cursor="grabbing",void this.translate(t.movementX,t.movementY);if(h)return a=!0,void(h.position={x:parseInt((this._mouse.x-h.dimension.width/2).toFixed(0)),y:parseInt((this._mouse.y-h.dimension.height/2).toFixed(0))});for(let t=0;t<this._entityManager.entities.length;t++){let i=this._entityManager.entities[t];if(i.contains(this._mouse.x,this._mouse.y))return d=i,this._el.style.cursor="grabbing",void(i._hover||(i._hover=!0,this._el.dispatchEvent(new CustomEvent("mouseenterentity",{detail:i}))));i._hover&&(i._hover=!1,this._el.dispatchEvent(new CustomEvent("mouseleaveentity",{detail:i})))}d=null,this._el.style.cursor="default",this._el.style.cursor="default"}),this._el.addEventListener("mousedown",t=>{if(d)return d._selected=!0,void(!h&&this._canMoveBlocks&&d.isDraggable&&(h=d));n=!0}),this._el.addEventListener("mouseup",t=>{n=!1,h&&(h._selected=!1,h=null)}),this._el.addEventListener("click",t=>{if(a)a=!1;else if(d){if(d.emit("click"),d._selected=!0,this._el.dispatchEvent(d.createEvent("clickentity")),0===r.length?r.push(d):r.forEach(t=>{t._id!==d._id&&r.push(d)}),2==r.length){let t=r.pop(),i=r.pop(),e=!1;for(let s=0;s<i.connections.length;s++){if(i.connections[s].to._id===t._id){e=!0;break}}for(let s=0;s<t.connections.length;s++){if(t.connections[s].to._id===i._id){e=!0;break}}e||i.addConnection({to:t}),r=[]}return}}),this._el.addEventListener("mouseout",t=>{n=!1,r=[],h=null,a=!1}),this._el.addEventListener("wheel",t=>{t.wheelDelta>0||t.deltaY<0?this.scale={horizontal:1.01,vertical:1.01}:this.scale={horizontal:.99,vertical:.99}});let l=null,c=null;this._el.addEventListener("touchstart",t=>{if(1===t.touches.length){const i=t.touches[0].clientX,e=t.touches[0].clientY,{x:s,y:o}=this.mousePosition({x:i,y:e});this._mouse.x=s,this._mouse.y=o;for(let t=0;t<this._entityManager.entities.length;t++){let i=this._entityManager.entities[t];if(i.contains(this._mouse.x,this._mouse.y))return d=i,h||(h=i),void this._el.dispatchEvent(i.createEvent("touchstartentity"))}n=!0,c&&(t.timeStamp,c.timeStamp,t.timeStamp-c.timeStamp<=200&&this._el.dispatchEvent(new CustomEvent("dbtouch",t))),c=t}}),this._el.addEventListener("touchmove",t=>{if(1===t.touches.length){const i=t.touches[0].clientX,e=t.touches[0].clientY,{x:s,y:o}=this.mousePosition({x:i,y:e});if(this._mouse.x=s,this._mouse.y=o,n&&l){const t=l.touches[0].clientX,i=l.touches[0].clientY;let e=this.mousePosition({x:t,y:i}),s=(this._mouse.x-e.x)*this._transform.scale.horizontal,o=(this._mouse.y-e.y)*this._transform.scale.vertical;this.translate(s,o)}else h&&(a=!0,h.position={x:parseInt((this._mouse.x-h.dimension.width/2).toFixed(0)),y:parseInt((this._mouse.y-h.dimension.height/2).toFixed(0))});l=t}}),this._el.addEventListener("touchend",t=>{h&&(h=null);const i=t.changedTouches[0].clientX,e=t.changedTouches[0].clientY,{x:s,y:o}=this.mousePosition({x:i,y:e});this._mouse.x=s,this._mouse.y=o;for(let t=0;t<this._entityManager.entities.length;t++){let i=this._entityManager.entities[t];i.contains(this._mouse.x,this._mouse.y)&&this._el.dispatchEvent(i.createEvent("touchendentity"))}n=!1,l=null}),this._evCache=[],this.prevDiff=-1;const g=t=>{_(t),this._evCache.length<2&&(this.prevDiff=-1)},_=t=>{for(var i=0;i<this._evCache.length;i++)if(this._evCache[i].pointerId==t.pointerId){this._evCache.splice(i,1);break}};this._el.onpointerdown=t=>{this._evCache.push(t)},this._el.onpointermove=t=>{for(var i=0;i<this._evCache.length;i++)if(t.pointerId==this._evCache[i].pointerId){this._evCache[i]=t;break}if(2==this._evCache.length){var e=Math.abs(this._evCache[0].clientX-this._evCache[1].clientX);this.prevDiff>0&&(e>this.prevDiff&&(this.scale={horizontal:1.01,vertical:1.01}),e<this.prevDiff&&(this.scale={horizontal:.99,vertical:.99})),this.prevDiff=e}},this._el.onpointerup=g,this._el.onpointercancel=g,this._el.onpointerout=g,this._el.onpointerleave=g;window.onresize=t=>{this._transform.dimension.width=this._el.parentElement.clientWidth,this._transform.dimension.height=this._el.parentElement.clientHeight,this._offscreenCanvas?(this._offscreenCanvas.width=this._transform.dimension.width,this._offscreenCanvas.height=this._transform.dimension.height):(this._el.width=this._transform.dimension.width,this._el.height=this._transform.dimension.height)},this.start()}clearFrame(){this._ctx.clearRect(0,0,this._transform.dimension.width,this._transform.dimension.height)}translate(t,i){this._transform.position.x+=t,this._transform.position.y+=i}start(){this._tickTime=new Date,this._intervalId=setInterval(()=>{this.tick()},1e3/this._fps)}stop(){this._startTime=null}tick(){const t=new Date,i=t-this._endTime;this.update(i),this._updateTime=new Date-t,this.draw(),this._endTime=new Date,this._drawTime=this._endTime-this._updateTime,this._tickTime=this._endTime-t}update(t){this._entityManager.entities.forEach(i=>{i.update(t)})}draw(){this.clearFrame(),this._ctx.save(),this._ctx.translate(this._transform.position.x+.5,this._transform.position.y+.5),this._ctx.scale(this._transform.scale.horizontal,this._transform.scale.vertical),this._entityManager.entities.forEach(t=>{t.draw(this._ctx)}),this._ctx.restore()}mousePosition(t){const i=this._el.getBoundingClientRect(),e=window.pageXOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop,o=i.top+s,n=i.left+e;return{x:(t.x-this._transform.position.x-n)/this._transform.scale.horizontal,y:(t.y-this._transform.position.y-o)/this._transform.scale.vertical}}setData(t){let i={};for(let[e,s]of Object.entries(t)){let t;s.name=e,s._name=e,t="conditional"===s.type?new D(s,this):new C(s,this),i[e]=t}for(let[e,s]of Object.entries(t))s.connections&&s.connections.forEach(t=>{const s=i[t.to];s&&(t.to=s,i[e].addConnection(t))});Object.values(i).forEach(t=>{this._entityManager.addEntity(t)})}get data(){let t={};const i=this._entityManager.entities;for(let e=0;e<i.length;e++){const s=i[e],o={};o.type=s instanceof C?"block":"conditional",Object.keys(i[e]).forEach(t=>{"_"!==t.charAt(0)&&(o[t]=s[t])}),o.connections=[];for(let t=0;t<s.connections.length;t++){let i=s.connections[t],e={};Object.keys(i).forEach(t=>{"_"!==t.charAt(0)&&(e[t]=i[t])}),e.to=i.to.name,o.connections.push(e)}t[s.name]=o}}get ctx(){return this._ctx}get mouse(){return this._mouse}get entityManager(){return this._entityManager}set scale(t){const i=this._transform.scale.horizontal*t.horizontal,e=this._transform.scale.vertical*t.vertical;i<this._scaleLimits.max&&e<this._scaleLimits.max&&i>=this._scaleLimits.min&&e>=this._scaleLimits.min&&(this._transform.scale.horizontal=i,this._transform.scale.vertical=e)}}class S{constructor({canvas:t,options:i,data:e}){this._canvas=new N({canvas:t,data:e,options:i})}getEntityByName(t){return this._canvas.entityManager.getEntityByName(t)}addEntity(t){this._canvas.entityManager.addEntity(t)}removeEntityByName(t){this._canvas.entityManager.removeEntityByName(t)}getData(){return this._canvas.data}setData(t){this._canvas.setData(t)}on(t,i){"onkeypress"===t||"onkeyup"===t||"onkeydown"===t?window[t]=i:this._canvas._el.addEventListener(t,i)}saveAsImage(t){var i=document.createElement("a");i.download=t+".png",i.href=canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),i.click()}}const M=()=>/Mobi|Android/i.test(navigator.userAgent)}])}));