!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.futureFlow=e():t.futureFlow=e()}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){function i(t,e){var i=[],s=[];return null==e&&(e=function(t,e){return i[0]===e?"[Circular ~]":"[Circular ~."+s.slice(0,i.indexOf(e)).join(".")+"]"}),function(o,n){if(i.length>0){var h=i.indexOf(this);~h?i.splice(h+1):i.push(this),~h?s.splice(h,1/0,o):s.push(o),~i.indexOf(n)&&(n=e.call(this,o,n))}else i.push(n);return null==t?n:t.call(this,o,n)}}(t.exports=function(t,e,s,o){return JSON.stringify(t,i(e,o),s)}).getSerialize=i},function(t,e,i){"use strict";i.r(e),i.d(e,"Flow",(function(){return r}));class s{static ANIMATION_SPEED(){return 1}static ANIMATION_TYPE(){return"circle"}static ANIMATION_FILL_COLOR(){return"rgb(212, 212, 212)"}static ANIMATION_PARTICLE_DISTANCE(){return 5}constructor({from:t,to:e,line:i,connector:o,isEditable:n,animation:h}){this.from=t,this.to=e,this.line=i,this.connector=o,this.isEditable=n,this.particles=[],this.animationStarted=!1,this.keepAddingParticles=!0,h&&(this.animation={speed:h.speed||s.ANIMATION_SPEED(),fillColor:h.fillColor||s.ANIMATION_FILL_COLOR(),type:h.type||s.ANIMATION_TYPE(),particleDistance:h.particleDistance||s.ANIMATION_PARTICLE_DISTANCE()})}get connectionPoints(){let t=1/0,e={};return this.from.sides.forEach(i=>{this.to.sides.forEach(s=>{const o=Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2));o<t&&(t=o,e={from:i,to:s})})}),e}get path(){let t=this.connectionPoints,e=t.from,i=t.to,s=Math.abs(i.x-e.x)/2,o=Math.abs(i.y-e.y)/2,n=[];return"left"===e.name&&"right"===i.name||"right"===e.name&&"left"===i.name?(e.x>i.x&&(s*=-1),n.push({x:parseInt(e.x.toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt((e.x+s).toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt((i.x-s).toFixed(0)),y:parseInt(i.y.toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt(i.y.toFixed(0))})):"bottom"!==e.name&&"top"!==e.name||"right"!==i.name&&"left"!==i.name?"right"!==e.name&&"left"!==e.name||"top"!==i.name&&"bottom"!==i.name?("top"===e.name&&"bottom"===i.name||"bottom"===e.name&&"top"===i.name)&&(e.y>i.y&&(o*=-1),n.push({x:parseInt(e.x.toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt(e.x.toFixed(0)),y:parseInt((e.y+o).toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt((i.y-o).toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt(i.y.toFixed(0))})):n.push({x:parseInt(e.x.toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt(i.y.toFixed(0))}):n.push({x:parseInt(e.x.toFixed(0)),y:parseInt(e.y.toFixed(0))},{x:parseInt(e.x.toFixed(0)),y:parseInt(i.y.toFixed(0))},{x:parseInt(i.x.toFixed(0)),y:parseInt(i.y.toFixed(0))}),n}draw(t){const e=this.path;if(e.length>0){t.save(),this.line?(t.lineWidth=this.line.width||2,t.strokeStyle=this.line.color||"rgb(212,212,212)",t.setLineDash(this.line.dashed||null)):(t.lineWidth=2,t.strokeStyle="rgb(212,212,212)"),t.lineWidth=1,t.lineCap="square",t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++){const s=e[i];t.lineTo(s.x,s.y),t.stroke()}if(t.closePath(),t.restore(),this.animation&&this.animationStarted)for(let i=0;i<this.particles.length;i++){let s=this.particles[i],o=0,n=0;(Math.abs(s.to.x-e[s.toIndex].x)>2||Math.abs(s.to.y-e[s.toIndex].y)>2)&&this.restartAnimation(),s.to=e[s.toIndex],s.distance>this.animation.particleDistance&&this.keepAddingParticles&&(s.addedParticle||(this.particles.push({x:e[0].x,y:e[0].y,toIndex:1,to:e[1],addedParticle:!1,distance:0}),s.addedParticle=!0)),s.y===s.to.y&&(o=s.x<=s.to.x?1:-1),s.x===s.to.x&&(n=s.y<=s.to.y?1:-1),s.x+=o*this.animation.speed,s.y+=n*this.animation.speed,Math.sqrt(Math.pow(s.x-s.to.x,2)+Math.pow(s.y-s.to.y,2))<=this.animation.speed&&(s.toIndex++,s.toIndex===e.length?this.particles.splice(0,1):(s.x=s.to.x,s.y=s.to.y,s.to=e[s.toIndex])),0===this.particles.length&&this.stopAnimation(),s.distance+=Math.abs(o),s.distance+=Math.abs(n),t.beginPath(),t.fillStyle=this.animation.fillColor,t.moveTo(s.x,s.y),"circle"===this.animation.type&&t.arc(s.x,s.y,5,0,2*Math.PI),t.fill(),t.closePath()}let i=e[e.length-1],s=e[e.length-2];i.x==s.x?i.y>s.y?(t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(i.x+10,i.y-10),t.lineTo(i.x-10,i.y-10)):(t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(i.x-10,i.y+10),t.lineTo(i.x+10,i.y+10)):i.x>s.x?(t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(i.x-10,i.y-10),t.lineTo(i.x-10,i.y+10)):(t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(i.x+10,i.y-10),t.lineTo(i.x+10,i.y+10)),this.connector?(t.strokeStyle=this.connector.color||"rgb(212,212,212)",t.lineWidth=this.connector.width||"rgb(212,212,212)",t.fillStyle=this.connector.fillColor||"rgb(212,212,212)"):(t.strokeStyle="rgb(212,212,212)",t.lineWidth="rgb(212,212,212)",t.fillStyle="rgb(212,212,212)"),t.stroke(),t.fill(),t.closePath()}}startAnimation(){this.particles.push({x:this.path[0].x,y:this.path[0].y,toIndex:1,to:this.path[1],addedParticle:!1,distance:0}),this.animationStarted=!0}restartAnimation(){this.stopAnimation(),this.startAnimation()}finishAnimation(){this.keepAddingParticles=!1}stopAnimation(){this.particles=[],this.animationStarted=!1}}var o=i(0),n=i.n(o);const h=function({fontFamily:t,fontSize:e,fontWeight:i}){var s=document.createElement("span");s.innerHTML="Hg",s.style.fontFamily=t,s.style.fontSize=e,s.style.fontWeight=i||"normal";var o=document.createElement("div");o.style.display="inline-block",o.style.width="1px",o.style.height="0px";var n=document.createElement("div");n.append(s,o),document.body.appendChild(n);try{var h={};o.style.verticalAlign="baseline",h.ascent=o.offsetTop-s.offsetTop,o.style.verticalAlign="bottom",h.height=o.offsetTop-s.offsetTop,h.descent=h.height-h.ascent}finally{n.remove()}return h};class a extends class extends class extends class{constructor(){this.callbacks={}}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}emit(t,e){let i=this.callbacks[t];i&&i.forEach(t=>t(e))}}{constructor({x:t,y:e,w:i,h:s,name:o}){super(),this.id=+new Date+1e5*Math.random(),this.name=o,this.x=t,this.y=e,this.w=i,this.h=s,this.selected=!1,this.hover=!1,this.connections=[]}draw(t){}createEvent(t){return new CustomEvent(t,{detail:this})}addConnection(t){t.from=this;const e=new s(t);this.connections.push(e)}contains(t,e){return t>=this.x&&t<=this.x+this.w&&e>=this.y&&e<=this.y+this.h}startAnimation(t){this.getConnection(t).startAnimation()}startAllAnimations(){this.connections.forEach(t=>{t.startAnimation()})}finishAllAnimations(){this.connections.forEach(t=>{t.finishAnimation()})}stopAnimation(t){this.getConnection(t).stopAnimation()}finishAnimation(t){this.getConnection(t).finishAnimation()}getConnection(t){return this.connections.find(e=>e.to.name===t.name)}removeConnection(t){for(let e=0;e<this.connections.length;e++)if(this.connections[e].to.name===t.name)return void this.connections.splice(e,1)}toString(){let t=[];return this.connections.forEach(e=>{t.push({to:{id:e.to.id,name:e.to.name}})}),n()({id:this.id,name:this.name,position:{x:this.x,y:this.y},connections:t},null,4)}preetier(){return"string"!=typeof(t=this.toString())&&(t=JSON.stringify(t,void 0,2)),(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(function(t){var e="number";return/^"/.test(t)?e=/:$/.test(t)?"key":"string":/true|false/.test(t)?e="boolean":/null/.test(t)&&(e="null"),'<span class="'+e+'">'+t+"</span>"}));var t}}{constructor(t,e,i,s){super(t,e,i,s)}get area(){return this.w*this.h}get center(){return{x:this.x+this.w/2,y:this.y+this.h/2}}draw(t){super.draw(t),t.fillStyle="black",t.beginPath(),t.rect(this.x,this.y,this.w,this.h),t.stroke(),Object.values(this.sides).forEach(e=>{t.beginPath(),t.strokeStyle="red",t.arc(e.x,e.y,2,0,2*Math.PI,!0),t.stroke()}),this.connections.forEach(e=>{e.draw(t),Object.values(e.closesPoints).forEach(e=>{t.beginPath(),t.strokeStyle="green",t.arc(e.x,e.y,2,0,2*Math.PI,!0),t.stroke()})})}}{static MAX_WIDTH(){return 350}static MAX_HEIGHT(){return 500}static PADDING(){return{top:15,right:15,bottom:15,left:15}}static ICON(){return{width:25,height:25}}constructor({x:t,y:e,name:i,isDraggable:s,background:o,shadow:n,border:r,header:l,body:d,footer:c,state:y,states:x}){super({x:t||0,y:e||0,w:1,h:1,name:i}),this.x=t||0,this.y=e||0,this.background=o||{color:"rgb(255,255,255)"},this.border=r||{radius:5,normal:{width:1,color:"black"},selected:{width:1,color:"black"},hover:{width:1,color:"black"}},this.shadow=n,this.isDraggable=0!=s,this.states=x||[],this.state=y,l&&(this.header=l,this._headerTextHeight=h({fontFamily:this.header.font.family,fontSize:this.header.font.size,fontWeight:this.header.font.weight}),this.header.padding=l.padding||a.PADDING()),d&&(this.body=d,this._bodyTextHeight=h({fontFamily:this.body.font.family,fontSize:this.body.font.size,fontWeight:this.body.font.weight}),this.body.padding=d.padding||a.PADDING()),c&&(this.footer=c,this._footerTextHeight=h({fontFamily:this.footer.font.family,fontSize:this.footer.font.size,fontWeight:this.footer.font.weight}),this.footer.padding=c.padding||a.PADDING()),this.on("mouseenter",()=>{this.hover=!0}),this.on("mouseleave",()=>{this.hover=!1})}get sides(){return[{x:this.x+this.w/2,y:this.y,name:"top"},{x:this.x+this.w,y:this.y+this.h/2,name:"right"},{x:this.x+this.w/2,y:this.y+this.h,name:"bottom"},{x:this.x,y:this.y+this.h/2,name:"left"}]}set state(t){this.states.includes(t)&&this.emit(t,{detail:this})}draw(t){let e=this.border.radius;var i=this.x+this.w,s=this.y+this.h;t.save(),this.shadow&&(t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offset.x,t.shadowOffsetY=this.shadow.offset.y),t.strokeStyle=this.border.normal.color,t.fillStyle=this.background.color,t.lineWidth=this.border.normal.width,t.beginPath(),t.moveTo(this.x+e,this.y),t.lineTo(i-e,this.y),t.quadraticCurveTo(i,this.y,i,this.y+e),t.lineTo(i,this.y+this.h-e),t.quadraticCurveTo(i,s,i-e,s),t.lineTo(this.x+e,s),t.quadraticCurveTo(this.x,s,this.x,s-e),t.lineTo(this.x,this.y+e),t.quadraticCurveTo(this.x,this.y,this.x+e,this.y),t.stroke(),t.fill(),t.closePath(),t.restore(),this.selected&&(t.save(),t.strokeStyle=this.border.selected.color,t.lineWidth=this.border.selected.width,t.beginPath(),t.moveTo(this.x+e,this.y),t.lineTo(i-e,this.y),t.quadraticCurveTo(i,this.y,i,this.y+e),t.lineTo(i,this.y+this.h-e),t.quadraticCurveTo(i,s,i-e,s),t.lineTo(this.x+e,s),t.quadraticCurveTo(this.x,s,this.x,s-e),t.lineTo(this.x,this.y+e),t.quadraticCurveTo(this.x,this.y,this.x+e,this.y),t.stroke(),t.closePath(),t.restore()),this.hover&&(t.save(),t.strokeStyle=this.border.hover.color,t.lineWidth=this.border.hover.width,t.beginPath(),t.moveTo(this.x+e,this.y),t.lineTo(i-e,this.y),t.quadraticCurveTo(i,this.y,i,this.y+e),t.lineTo(i,this.y+this.h-e),t.quadraticCurveTo(i,s,i-e,s),t.lineTo(this.x+e,s),t.quadraticCurveTo(this.x,s,this.x,s-e),t.lineTo(this.x,this.y+e),t.quadraticCurveTo(this.x,this.y,this.x+e,this.y),t.stroke(),t.closePath(),t.restore());let o=0,n=0;if(this.header){t.textBaseline="top",t.font=`${this.header.font.style} ${this.header.font.variant} ${this.header.font.weight} ${this.header.font.size}px ${this.header.font.family}`,t.fillStyle=this.header.font.color,t.textAlign=this.header.alignment;let e,i=0,s=0;this.header.icon&&(i=a.ICON().width,s=a.ICON().height,t.drawImage(img,this.x+this.header.padding.left,this.y+this.header.padding.top,i,s)),this._headerTextHeight.height<s?(o=this.header.padding.top+s+this.header.padding.bottom,e=(o-this._headerTextHeight.ascent)/2):(o=this.header.padding.top+this._headerTextHeight.ascent+this.header.padding.bottom,e=this.header.padding.top),n=0!==i?this.header.padding.left+i+this.header.padding.right+t.measureText(this.header.text).width+this.header.padding.right:t.measureText(this.header.text).width;let h=0;h="center"===this.header.alignment?this.x+this.w/2:this.x+i+this.header.padding.right+(this.header.icon?this.header.padding.left:0),t.fillText(this.header.text,h,this.y+e),this.header.divider&&(t.save(),t.strokeStyle=this.header.divider.color,t.lineWidth=this.header.divider.width,t.beginPath(),t.moveTo(this.x,this.y+o),t.lineTo(this.x+this.w,this.y+o),t.stroke(),t.closePath(),t.restore())}let h=0,r=0;if(this.body){t.save(),t.font=`${this.body.font.style} ${this.body.font.variant} ${this.body.font.weight} ${this.body.font.size}px ${this.body.font.family}`,t.fillStyle=this.body.font.color,t.textAlign=this.body.alignment,t.textBaseline="top";let e=[];const i=this.body.text.split(" ");let s=0;i.forEach(i=>{const o=t.measureText(i).width,n=t.measureText(e[s]||"").width;this.body.padding.left+n+o+this.body.padding.right>a.MAX_WIDTH()&&s++;let h=e[s]||"";e[s]=h+=(h.length>0?" ":"")+i}),e.forEach((e,i)=>{const s=this.y+o+this._bodyTextHeight.height*i+this.body.padding.top;t.fillText(e,this.x+this.body.padding.left,s);const n=t.measureText(e).width;r=n>r?n:r}),t.restore(),h=this.body.padding.top+e.length*this._bodyTextHeight.height+this.body.padding.bottom,r+=this.body.padding.left+this.body.padding.right}let l=0,d=0;this.footer&&(this.footer.divider&&(t.save(),t.strokeStyle=this.footer.divider.color,t.lineWidth=this.footer.divider.width,t.beginPath(),t.moveTo(this.x,this.y+o+h),t.lineTo(this.x+this.w,this.y+o+h),t.stroke(),t.closePath(),t.restore()),t.textBaseline="top",t.font=`${this.footer.font.style} ${this.footer.font.variant} ${this.footer.font.weight} ${this.footer.font.size}px ${this.footer.font.family}`,t.fillStyle=this.footer.font.color,t.textAlign=this.footer.alignment,t.alignment="top",t.fillText(this.footer.text,this.x+this.footer.padding.left,this.y+o+h+this.footer.padding.top),l=this.footer.padding.top+this._footerTextHeight.height+this.footer.padding.bottom,d=this.footer.padding.left+t.measureText(this.footer.text).width+this.footer.padding.right);const c=n>r&&n>d?n:r>d?r:d,y=o+h+l;this.w=c>0?c:100,this.h=y>0?y:100,this.w=parseInt(this.w.toFixed(0)),this.h=parseInt(this.h.toFixed(0)),this.connections.forEach(e=>{e.draw(t)})}}class r{static MAX_SCALE(){return 2}static MIN_SCALE(){return.2}constructor({canvas:t,options:e,data:i}){this.isDrawing=!1,this.el=t||document.getElementById("canvas"),this.el.width=this.el.parentElement.clientWidth,this.el.height=this.el.parentElement.clientHeight,this.el.style.maxHeight="none",this.origin={x:0,y:0},this.data=i,this.options=e,this.intervalId=null,this.drawOrigin=e.drawOrigin||!1,this.background=e.background||{color:"rgb(255, 255, 255)"},this.scaleLimits={max:e.zoom.max||Canvas.MAX_SCALE(),min:e.zoom.min||Canvas.MIN_SCALE()},this.fps=e.fps||60,this.el.style.backgroundColor=this.background.color,this.scale={horizontal:1,vertical:1},this.setScale({horizontal:e.zoom.level||1,vertical:e.zoom.level||1}),this.canMoveBlocks=e.canMoveBlocks||!1;let s=[],o=null,n=!1;this.el.addEventListener("mousemove",t=>{const{mxts:e,myts:i}=this.mousePosition(t);if(this._isDraggingCanvas)this.translate(t.movementX,t.movementY);else if(o)n=!0,o.x=parseInt((e-o.w/2).toFixed(0)),o.y=parseInt((i-o.h/2).toFixed(0));else for(let t=0;t<this.entitiesArray.length;t++){let s=this.entitiesArray[t];s.contains(e,i)?s.hover||(s.hover=!0,this.el.dispatchEvent(new CustomEvent("mouseenterentity",{detail:s}))):s.hover&&(s.hover=!1,this.el.dispatchEvent(new CustomEvent("mouseleaveentity",{detail:s})))}}),this.el.addEventListener("dblclick",t=>{const{mxts:e,myts:i}=this.mousePosition(t);this.addEntity(new a({x:e,y:i,header:{text:"Lorem ipsum dolor sit",alignment:"start",font:{family:"Times",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:25,weight:"bold"}},body:{text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at consectetur lorem. Etiam dignissim dolor sit amet orci efficitur auctor.",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}},footer:{text:"Lorem ipsum dolor sit",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}}}))}),this.el.addEventListener("click",t=>{const{mxts:e,myts:i}=this.mousePosition(t);if(n)n=!1;else{for(let t=0;t<this.entitiesArray.length;t++){let o=this.entitiesArray[t];if(o.contains(e,i)){if(o.emit("click"),this.el.dispatchEvent(o.createEvent("clickentity")),0===s.length?s.push(o):s.forEach(t=>{t._id!==o._id&&s.push(o)}),2==s.length){let t=s.pop(),e=s.pop(),i=!1;for(let s=0;s<e.connections.length;s++){if(e.connections[s].to._id===t._id){i=!0;break}}for(let s=0;s<t.connections.length;s++){if(t.connections[s].to._id===e._id){i=!0;break}}i||e.addConnection({to:t}),s=[]}return}}s=[]}}),this.el.addEventListener("mousedown",t=>{const{mxts:e,myts:i}=this.mousePosition(t);for(let t=0;t<this.entitiesArray.length;t++){let s=this.entitiesArray[t];if(s.contains(e,i))return void(!o&&this.canMoveBlocks&&s.isDraggable&&(o=s))}this._isDraggingCanvas=!0}),this.el.addEventListener("mouseup",t=>{this._isDraggingCanvas=!1,o&&(o=null)}),this.el.addEventListener("wheel",t=>{t.wheelDelta>0?this.setScale({horizontal:1.01,vertical:1.01}):this.setScale({horizontal:.99,vertical:.99})});let h=null,r=null;this.el.addEventListener("touchstart",t=>{if(1===t.touches.length){const e=t.touches[0].clientX,i=t.touches[0].clientY,{mxts:s,myts:n}=this.mousePosition({x:e,y:i});for(let t=0;t<this.entitiesArray.length;t++){let e=this.entitiesArray[t];if(e.contains(s,n))return o||(o=e),void this.el.dispatchEvent(e.createEvent("touchstartentity"))}this._isDraggingCanvas=!0,r&&(t.timeStamp,r.timeStamp,t.timeStamp-r.timeStamp<=200&&this.el.dispatchEvent(new CustomEvent("dbtouch",t))),r=t}}),this.el.addEventListener("touchmove",t=>{if(1===t.touches.length){const e=t.touches[0].clientX,i=t.touches[0].clientY,{mxts:s,myts:a}=this.mousePosition({x:e,y:i});if(this._isDraggingCanvas&&h){const t=h.touches[0].clientX,e=h.touches[0].clientY;let i=this.mousePosition({x:t,y:e});i.mxts,i.myts;let o=(s-i.mxts)*this.scale.horizontal,n=(a-i.myts)*this.scale.vertical;this.translate(o,n)}else o&&(n=!0,o.x=s-o.w/2,o.y=a-o.h/2);h=t}}),this.el.addEventListener("touchend",t=>{o&&(o=null);const e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY,{mxts:s,myts:n}=this.mousePosition({x:e,y:i});for(let t=0;t<this.entitiesArray.length;t++){let e=this.entitiesArray[t];e.contains(s,n)&&this.el.dispatchEvent(e.createEvent("touchendentity"))}this._isDraggingCanvas=!1,h=null}),window.addEventListener("resize",()=>{this.el.width=this.el.parentElement.clientWidth,this.el.height=this.el.parentElement.clientHeight},!1),this.start()}get ctx(){return this.el.getContext("2d")}get entitiesArray(){return Object.values(this.entities)}set data(t){this.entities={};let e={};if(t&&Object.values(t).length>0){for(let[i,s]of Object.entries(t))if(s){let t=new a(s);t.name=i,e[i]=t,this.addEntity(t)}for(let[i,s]of Object.entries(t))s&&s.connections&&s.connections.forEach(t=>{e[t.to]&&(t.to=e[t.to],e[i].addConnection(t))})}}setScale({horizontal:t,vertical:e}){const i=this.scale.horizontal*t,s=this.scale.vertical*e;i<this.scaleLimits.max&&s<this.scaleLimits.max&&i>=this.scaleLimits.min&&s>=this.scaleLimits.min&&(this.scale.horizontal=i,this.scale.vertical=s)}addEntity(t){this.entities[t.name]=t}removeEntity(t){this.entitiesArray.forEach(e=>{e.removeConnection(t)}),delete this.entities[t.name]}clear(){this.ctx.clearRect(0,0,canvas.width,canvas.height)}translate(t,e){this.origin.x+=t,this.origin.y+=e}start(){this.intervalId=setInterval(()=>{this.clear(),this.ctx.save(),this.drawOrigin&&(this.ctx.lineWidth="1",this.ctx.strokeStyle="rgba(0,0,0,0.2)",this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x,this.origin.y+100*this.el.height),this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x+100*this.el.width,this.origin.y),this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x-100*this.el.width,this.origin.y),this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x,this.origin.y-100*this.el.height),this.ctx.stroke()),this.ctx.translate(this.origin.x+.5,this.origin.y+.5),this.ctx.scale(this.scale.horizontal,this.scale.vertical),Object.values(this.entities).forEach(t=>{t.draw(this.ctx)}),this.ctx.restore()},1e3/this.fps)}stop(){clearInterval(this.intervalId)}getEntities(){return n()(this.entities)}on(t,e){this.el.addEventListener(t,e)}mousePosition(t){let e=this.el.getBoundingClientRect(),i=window.pageXOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop,o=e.top+s,n=e.left+i;return{mxts:(t.x-this.origin.x-n)/this.scale.horizontal,myts:(t.y-this.origin.y-o)/this.scale.vertical}}getEntityByName(t){return this.entities[t]}}}])}));