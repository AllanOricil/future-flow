!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.futureFlow=e():t.futureFlow=e()}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){function i(t,e){var i=[],s=[];return null==e&&(e=function(t,e){return i[0]===e?"[Circular ~]":"[Circular ~."+s.slice(0,i.indexOf(e)).join(".")+"]"}),function(o,h){if(i.length>0){var n=i.indexOf(this);~n?i.splice(n+1):i.push(this),~n?s.splice(n,1/0,o):s.push(o),~i.indexOf(h)&&(h=e.call(this,o,h))}else i.push(h);return null==t?h:t.call(this,o,h)}}(t.exports=function(t,e,s,o){return JSON.stringify(t,i(e,o),s)}).getSerialize=i},function(t,e,i){"use strict";i.r(e),i.d(e,"Flow",(function(){return a}));class s{constructor(t,e){this.from=t,this.to=e}get connectionPoints(){let t=1/0,e={};return this.from.sides.forEach(i=>{this.to.sides.forEach(s=>{const o=Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2));o<t&&(t=o,e={from:i,to:s})})}),e}get path(){let t=this.connectionPoints,e=t.from,i=t.to,s=Math.abs(i.x-e.x)/2,o=Math.abs(i.y-e.y)/2,h=[];return"left"===e.name&&"right"===i.name||"right"===e.name&&"left"===i.name?(e.x>i.x&&(s*=-1),h.push({x:e.x,y:e.y},{x:e.x+s,y:e.y},{x:i.x-s,y:i.y},{x:i.x,y:i.y})):"bottom"!==e.name&&"top"!==e.name||"right"!==i.name&&"left"!==i.name?"right"!==e.name&&"left"!==e.name||"top"!==i.name&&"bottom"!==i.name?("top"===e.name&&"bottom"===i.name||"bottom"===e.name&&"top"===i.name)&&(e.y>i.y&&(o*=-1),h.push({x:e.x,y:e.y},{x:e.x,y:e.y+o},{x:i.x,y:i.y-o},{x:i.x,y:i.y})):h.push({x:e.x,y:e.y},{x:i.x,y:e.y},{x:i.x,y:i.y}):h.push({x:e.x,y:e.y},{x:e.x,y:i.y},{x:i.x,y:i.y}),h}draw(t){if(this.path.length>0){t.lineWidth="2",t.strokeStyle="rgb(200,200,200)",t.beginPath(),t.moveTo(this.path[0].x,this.path[0].y),this.path.forEach(e=>{t.lineTo(Math.ceil(e.x),Math.ceil(e.y)),t.stroke()}),t.closePath();let e=this.path[this.path.length-1],i=this.path[this.path.length-2];e.x==i.x?e.y>i.y?(t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x+10,e.y-10),t.lineTo(e.x-10,e.y-10)):(t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x-10,e.y+10),t.lineTo(e.x+10,e.y+10)):e.x>i.x?(t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x-10,e.y-10),t.lineTo(e.x-10,e.y+10)):(t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x+10,e.y-10),t.lineTo(e.x+10,e.y+10)),t.fillStyle="rgb(200,200,200)",t.fill(),t.closePath()}}}var o=i(0),h=i.n(o);const n=function({fontFamily:t,fontSize:e,fontWeight:i}){var s=document.createElement("span");s.innerHTML="Hg",s.style.fontFamily=t,s.style.fontSize=e,s.style.fontWeight=i||"normal";var o=document.createElement("div");o.style.display="inline-block",o.style.width="1px",o.style.height="0px";var h=document.createElement("div");h.append(s,o),document.body.appendChild(h);try{var n={};o.style.verticalAlign="baseline",n.ascent=o.offsetTop-s.offsetTop,o.style.verticalAlign="bottom",n.height=o.offsetTop-s.offsetTop,n.descent=n.height-n.ascent}finally{h.remove()}return n};class r extends class extends class extends class{constructor(){this.callbacks={}}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}emit(t,e){let i=this.callbacks[t];i&&i.forEach(t=>t(e))}}{constructor(t,e,i,s){super(),this._id=+new Date+1e5*Math.random(),this.x=t,this.y=e,this.w=i,this.h=s,this.events=[],this.selected=!1,this.hover=!1,this.connections=[]}get area(){return this.w*this.h}get center(){return{x:this.x+this.w/2,y:this.y+this.h/2}}get sides(){return[{x:this.x+this.w/2,y:this.y,name:"top"},{x:this.x+this.w,y:this.y+this.h/2,name:"right"},{x:this.x+this.w/2,y:this.y+this.h,name:"bottom"},{x:this.x,y:this.y+this.h/2,name:"left"}]}createEvent(t){return new CustomEvent(t,{detail:this})}addConnection(t){const e=new s(this,t);this.connections.push(e)}draw(t){}contains(t,e){return t>=this.x&&t<=this.x+this.w&&e>=this.y&&e<=this.y+this.h}get toString(){return"string"!=typeof(t=h()(this,null,4))&&(t=JSON.stringify(t,void 0,2)),(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(function(t){var e="number";return/^"/.test(t)?e=/:$/.test(t)?"key":"string":/true|false/.test(t)?e="boolean":/null/.test(t)&&(e="null"),'<span class="'+e+'">'+t+"</span>"}));var t}}{constructor(t,e,i,s){super(t,e,i,s)}draw(t){super.draw(t),t.fillStyle="black",t.beginPath(),t.rect(this.x,this.y,this.w,this.h),t.stroke(),Object.values(this.sides).forEach(e=>{t.beginPath(),t.strokeStyle="red",t.arc(e.x,e.y,2,0,2*Math.PI,!0),t.stroke()}),this.connections.forEach(e=>{e.draw(t),Object.values(e.closesPoints).forEach(e=>{t.beginPath(),t.strokeStyle="green",t.arc(e.x,e.y,2,0,2*Math.PI,!0),t.stroke()})})}}{static MAX_WIDTH(){return 350}static MAX_HEIGHT(){return 500}static PADDING(){return{top:15,right:15,bottom:15,left:15}}static ICON(){return{width:25,height:25}}constructor({x:t,y:e,isDraggable:i,background:s,shadow:o,border:h,header:a,body:l,footer:d}){super(t||0,e||0,1,1),this.x=t||0,this.y=e||0,this.background=s||{color:"rgb(255,255,255)"},this.border=h||{radius:5,normal:{width:1,color:"black"},selected:{width:1,color:"black"},hover:{width:1,color:"black"}},this.shadow=o,this.isDraggable=0!=i,a&&(this.header=a,this._headerTextHeight=n({fontFamily:this.header.font.family,fontSize:this.header.font.size,fontWeight:this.header.font.weight}),this.header.padding=a.padding||r.PADDING()),l&&(this.body=l,this._bodyTextHeight=n({fontFamily:this.body.font.family,fontSize:this.body.font.size,fontWeight:this.body.font.weight}),this.body.padding=l.padding||r.PADDING()),d&&(this.footer=d,this._footerTextHeight=n({fontFamily:this.footer.font.family,fontSize:this.footer.font.size,fontWeight:this.footer.font.weight}),this.footer.padding=d.padding||r.PADDING()),this.on("mouseenter",()=>{this.hover=!0}),this.on("mouseleave",()=>{this.hover=!1})}draw(t){let e=this.border.radius;var i=this.x+this.w,s=this.y+this.h;t.save(),this.shadow&&(t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offset.x,t.shadowOffsetY=this.shadow.offset.y),t.strokeStyle=this.border.normal.color,t.fillStyle=this.background.color,t.lineWidth=this.border.normal.width,t.beginPath(),t.moveTo(this.x+e,this.y),t.lineTo(i-e,this.y),t.quadraticCurveTo(i,this.y,i,this.y+e),t.lineTo(i,this.y+this.h-e),t.quadraticCurveTo(i,s,i-e,s),t.lineTo(this.x+e,s),t.quadraticCurveTo(this.x,s,this.x,s-e),t.lineTo(this.x,this.y+e),t.quadraticCurveTo(this.x,this.y,this.x+e,this.y),t.stroke(),t.fill(),t.closePath(),t.restore(),this.selected&&(t.save(),t.strokeStyle=this.border.selected.color,t.lineWidth=this.border.selected.width,t.beginPath(),t.moveTo(this.x+e,this.y),t.lineTo(i-e,this.y),t.quadraticCurveTo(i,this.y,i,this.y+e),t.lineTo(i,this.y+this.h-e),t.quadraticCurveTo(i,s,i-e,s),t.lineTo(this.x+e,s),t.quadraticCurveTo(this.x,s,this.x,s-e),t.lineTo(this.x,this.y+e),t.quadraticCurveTo(this.x,this.y,this.x+e,this.y),t.stroke(),t.closePath(),t.restore()),this.hover&&(t.save(),t.strokeStyle=this.border.hover.color,t.lineWidth=this.border.hover.width,t.beginPath(),t.moveTo(this.x+e,this.y),t.lineTo(i-e,this.y),t.quadraticCurveTo(i,this.y,i,this.y+e),t.lineTo(i,this.y+this.h-e),t.quadraticCurveTo(i,s,i-e,s),t.lineTo(this.x+e,s),t.quadraticCurveTo(this.x,s,this.x,s-e),t.lineTo(this.x,this.y+e),t.quadraticCurveTo(this.x,this.y,this.x+e,this.y),t.stroke(),t.closePath(),t.restore());let o=0,h=0;if(this.header){t.textBaseline="top",t.font=`${this.header.font.style} ${this.header.font.variant} ${this.header.font.weight} ${this.header.font.size}px ${this.header.font.family}`,t.fillStyle=this.header.font.color,t.textAlign=this.header.alignment;let e,i=0,s=0;this.header.icon&&(i=r.ICON().width,s=r.ICON().height,t.drawImage(img,this.x+this.header.padding.left,this.y+this.header.padding.top,i,s)),this._headerTextHeight.height<s?(o=this.header.padding.top+s+this.header.padding.bottom,e=(o-this._headerTextHeight.ascent)/2):(o=this.header.padding.top+this._headerTextHeight.ascent+this.header.padding.bottom,e=this.header.padding.top);const n=this.x+i+this.header.padding.right+(this.header.icon?this.header.padding.left:0);t.fillText(this.header.text,n,this.y+e),h=this.header.padding.left+i+this.header.padding.right+t.measureText(this.header.text).width+this.header.padding.right,this.header.divider&&(t.save(),t.strokeStyle=this.header.divider.color,t.lineWidth=this.header.divider.width,t.beginPath(),t.moveTo(this.x,this.y+o),t.lineTo(this.x+this.w,this.y+o),t.stroke(),t.closePath(),t.restore())}let n=0,a=0;if(this.body){t.save(),t.font=`${this.body.font.style} ${this.body.font.variant} ${this.body.font.weight} ${this.body.font.size}px ${this.body.font.family}`,t.fillStyle=this.body.font.color,t.textAlign=this.body.alignment,t.textBaseline="top";let e=[];const i=this.body.text.split(" ");let s=0;i.forEach(i=>{const o=t.measureText(i).width,h=t.measureText(e[s]||"").width;this.body.padding.left+h+o+this.body.padding.right>r.MAX_WIDTH()&&s++;let n=e[s]||"";e[s]=n+=(n.length>0?" ":"")+i}),e.forEach((e,i)=>{const s=this.y+o+this._bodyTextHeight.height*i+this.body.padding.top;t.fillText(e,this.x+this.body.padding.left,s);const h=t.measureText(e).width;a=h>a?h:a}),t.restore(),n=this.body.padding.top+e.length*this._bodyTextHeight.height+this.body.padding.bottom,a+=this.body.padding.left+this.body.padding.right}let l=0,d=0;this.footer&&(this.footer.divider&&(t.save(),t.strokeStyle=this.footer.divider.color,t.lineWidth=this.footer.divider.width,t.beginPath(),t.moveTo(this.x,this.y+o+n),t.lineTo(this.x+this.w,this.y+o+n),t.stroke(),t.closePath(),t.restore()),t.textBaseline="top",t.font=`${this.footer.font.style} ${this.footer.font.variant} ${this.footer.font.weight} ${this.footer.font.size}px ${this.footer.font.family}`,t.fillStyle=this.footer.font.color,t.textAlign=this.footer.alignment,t.alignment="top",t.fillText(this.footer.text,this.x+this.footer.padding.left,this.y+o+n+this.footer.padding.top),l=this.footer.padding.top+this._footerTextHeight.height+this.footer.padding.bottom,d=this.footer.padding.left+t.measureText(this.footer.text).width+this.footer.padding.right);const c=h>a&&h>d?h:a>d?a:d,g=o+n+l;this.w=c>0?c:100,this.h=g>0?g:100,this.connections.forEach(e=>{e.draw(t)})}}class a{static MAX_SCALE(){return 2}static MIN_SCALE(){return.2}constructor({canvas:t,options:e,data:i}){this.isDrawing=!1,this.el=t||document.getElementById("canvas"),this.el.width=this.el.parentElement.clientWidth,this.el.height=this.el.parentElement.clientHeight,this.el.style.maxHeight="none",this.origin={x:0,y:0},this.data=i,this._isDraggingCanvas=!1,this.isDebugging=e.isDebugging||!1,this.drawOrigin=e.drawOrigin||!1,this.background=e.background||{color:"rgb(255, 255, 255)"},this.scaleLimits={max:e.zoom.max||Canvas.MAX_SCALE(),min:e.zoom.min||Canvas.MIN_SCALE()},this.fps=e.fps||60,this.el.style.backgroundColor=this.background.color;let s={horizontal:1,vertical:1};this.getScale=()=>s,this.setScale=(t,e)=>{const i=s.horizontal*t,o=s.vertical*e;i<this.scaleLimits.max&&o<this.scaleLimits.max&&i>=this.scaleLimits.min&&o>=this.scaleLimits.min&&(s={horizontal:i,vertical:o})},this.canMoveBlocks=e.canMoveBlocks||!1;let o=[],h=null,n=!1;this.el.addEventListener("mousemove",t=>{const{mxts:e,myts:i}=this.mousePosition(t);if(this._isDraggingCanvas)this.translate(t.movementX,t.movementY);else if(h)n=!0,h.x=e-h.w/2,h.y=i-h.h/2;else for(let t=0;t<this.entitiesArray.length;t++){let s=this.entitiesArray[t];s.contains(e,i)?s.hover||(s.emit("mouseenter"),this.el.dispatchEvent(new CustomEvent("mouseenterentity",{detail:s}))):s.hover&&(s.emit("mouseleave"),this.el.dispatchEvent(new CustomEvent("mouseleaveentity",{detail:s})))}}),this.el.addEventListener("dblclick",t=>{const{mxts:e,myts:i}=this.mousePosition(t);this.addEntity(new r({x:e,y:i,header:{text:"Lorem ipsum dolor sit",alignment:"start",font:{family:"Times",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:25,weight:"bold"}},body:{text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at consectetur lorem. Etiam dignissim dolor sit amet orci efficitur auctor.",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}},footer:{text:"Lorem ipsum dolor sit",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}}}))}),this.el.addEventListener("click",t=>{const{mxts:e,myts:i}=this.mousePosition(t);if(n)n=!1;else{for(let t=0;t<this.entitiesArray.length;t++){let s=this.entitiesArray[t];if(s.contains(e,i)){if(s.emit("click"),this.el.dispatchEvent(s.createEvent("clickentity")),0===o.length?o.push(s):o.forEach(t=>{t._id!==s._id&&o.push(s)}),2==o.length){let t=o.pop(),e=o.pop(),i=!1;for(let s=0;s<e.connections.length;s++){if(e.connections[s].to._id===t._id){i=!0;break}}for(let s=0;s<t.connections.length;s++){if(t.connections[s].to._id===e._id){i=!0;break}}i||e.addConnection(t),o=[]}return}}o=[]}}),this.el.addEventListener("mousedown",t=>{const{mxts:e,myts:i}=this.mousePosition(t);for(let t=0;t<this.entitiesArray.length;t++){let s=this.entitiesArray[t];if(s.contains(e,i))return s._id,s.isDraggable,void(!h&&this.canMoveBlocks&&s.isDraggable&&(h=s))}this._isDraggingCanvas=!0}),this.el.addEventListener("mouseup",t=>{this._isDraggingCanvas=!1,h&&(h=null)}),this.el.addEventListener("wheel",t=>{t.wheelDelta>0?this.setScale(1.01,1.01):this.setScale(.99,.99)});let a=null,l=null;this.el.addEventListener("touchstart",t=>{if(1===t.touches.length){const e=t.touches[0].clientX,i=t.touches[0].clientY,{mxts:s,myts:o}=this.mousePosition({x:e,y:i});for(let t=0;t<this.entitiesArray.length;t++){let e=this.entitiesArray[t];if(e.contains(s,o))return h||(h=e),void this.el.dispatchEvent(e.createEvent("touchstartentity"))}this._isDraggingCanvas=!0,l&&(t.timeStamp,l.timeStamp,t.timeStamp-l.timeStamp<=200&&this.el.dispatchEvent(new CustomEvent("dbtouch",t))),l=t}}),this.el.addEventListener("touchmove",t=>{if(1===t.touches.length){const e=t.touches[0].clientX,i=t.touches[0].clientY,{mxts:s,myts:o}=this.mousePosition({x:e,y:i});if(this._isDraggingCanvas&&a){const t=a.touches[0].clientX,e=a.touches[0].clientY;let i=this.mousePosition({x:t,y:e});i.mxts,i.myts;let h=(s-i.mxts)*this.getScale().horizontal,n=(o-i.myts)*this.getScale().vertical;this.translate(h,n)}else h&&(n=!0,h.x=s-h.w/2,h.y=o-h.h/2);a=t}}),this.el.addEventListener("touchend",t=>{h&&(h=null);const e=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY,{mxts:s,myts:o}=this.mousePosition({x:e,y:i});for(let t=0;t<this.entitiesArray.length;t++){let e=this.entitiesArray[t];e.contains(s,o)&&this.el.dispatchEvent(e.createEvent("touchendentity"))}this._isDraggingCanvas=!1,a=null}),window.addEventListener("resize",()=>{this.el.width=this.el.parentElement.clientWidth,this.el.height=this.el.parentElement.clientHeight},!1),this.start()}get ctx(){return this.el.getContext("2d")}get entitiesArray(){return Object.values(this.entities)}addEntity(t){this.entities[t._id]=t}removeEntity(t){delete this.entities[t._id]}clear(){this.ctx.clearRect(0,0,canvas.width,canvas.height)}translate(t,e){this.origin.x+=t,this.origin.y+=e}start(){setInterval(()=>{this.isDrawing&&(this.clear(),this.drawOrigin&&(this.ctx.lineWidth="1",this.ctx.strokeStyle="rgba(0,0,0,0.2)",this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x,this.origin.y+100*this.el.height),this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x+100*this.el.width,this.origin.y),this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x-100*this.el.width,this.origin.y),this.ctx.moveTo(this.origin.x,this.origin.y),this.ctx.lineTo(this.origin.x,this.origin.y-100*this.el.height),this.ctx.stroke()),this.ctx.save(),this.ctx.translate(this.origin.x,this.origin.y),this.ctx.scale(this.getScale().horizontal,this.getScale().vertical),Object.values(this.entities).forEach(t=>{t.draw(this.ctx)}),this.ctx.restore())},1e3/this.fps)}set data(t){this.entities={};let e={};if(t&&Object.values(t).length>0){for(let[i,s]of Object.entries(t))if(s){let t=new r(s);this.addEntity(t),e[i]=t}for(let[i,s]of Object.entries(t))s&&s.connections&&s.connections.forEach(t=>{e[t]&&e[i].addConnection(e[t])})}this.isDrawing=!0}getEntities(){return h()(this.entities)}on(t,e){this.el.addEventListener(t,e)}mousePosition(t){let e=this.el.getBoundingClientRect(),i=window.pageXOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop,o=e.top+s,h=e.left+i;return{mxts:(t.x-this.origin.x-h)/this.getScale().horizontal,myts:(t.y-this.origin.y-o)/this.getScale().vertical}}}}])}));