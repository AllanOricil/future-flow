"use strict";var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],o=!0,n=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);o=!0);}catch(t){n=!0,r=t}finally{try{!o&&s.return&&s.return()}finally{if(n)throw r}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_get=function t(e,i,o){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,o)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(o):void 0},_createClass=function(){function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}();function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var img=new Image;img.src="./bell.svg";var EventEmitter=function(){function t(){_classCallCheck(this,t),this.callbacks={}}return _createClass(t,[{key:"on",value:function(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}},{key:"emit",value:function(t,e){var i=this.callbacks[t];i&&i.forEach(function(t){return t(e)})}}]),t}(),Entity=function(){function r(t,e,i,o){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return n.x=t,n.y=e,n.w=i,n.h=o,n.events=[],n.connections=[],n.selected=!1,n._id=+new Date+1e5*Math.random(),n}return _inherits(r,EventEmitter),_createClass(r,[{key:"addConnection",value:function(t){var e=new Connection(this,t);this.connections.push(e)}},{key:"draw",value:function(){}},{key:"contains",value:function(t,e){return t>=this.x&&t<=this.x+this.w&&e>=this.y&&e<=this.y+this.h}},{key:"area",get:function(){return this.w*this.h}},{key:"center",get:function(){return{x:this.x+this.w/2,y:this.y+this.h/2}}},{key:"sides",get:function(){return[{x:this.x+this.w/2,y:this.y,name:"top"},{x:this.x+this.w,y:this.y+this.h/2,name:"right"},{x:this.x+this.w/2,y:this.y+this.h,name:"bottom"},{x:this.x,y:this.y+this.h/2,name:"left"}]}}]),r}(),Rect=function(){function n(t,e,i,o){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e,i,o))}return _inherits(n,Entity),_createClass(n,[{key:"draw",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"draw",this).call(this,e),e.fillStyle="black",e.beginPath(),e.rect(this.x,this.y,this.w,this.h),e.stroke(),Object.values(this.sides).forEach(function(t){e.beginPath(),e.strokeStyle="red",e.arc(t.x,t.y,2,0,2*Math.PI,!0),e.stroke()}),this.connections.forEach(function(t){t.draw(e),Object.values(t.closesPoints).forEach(function(t){e.beginPath(),e.strokeStyle="green",e.arc(t.x,t.y,2,0,2*Math.PI,!0),e.stroke()})})}}]),n}(),Block=function(){function d(t){var e=t.x,i=t.y,o=t.header,n=t.body,r=t.footer;_classCallCheck(this,d);var a=_possibleConstructorReturn(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,e||0,i||0,1,1));return a.x=e||0,a.y=i||0,a.header=o||{text:"Header",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"},icon:"./bell.svg"},a.body=n||{text:"Body",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}},a.footer=r||{text:"Footer",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}},a._headerTextHeight=getTextHeight({fontFamily:a.header.font.family,fontSize:a.header.font.size,fontWeight:a.header.font.weight}),a._bodyTextHeight=getTextHeight({fontFamily:a.body.font.family,fontSize:a.body.font.size,fontWeight:a.body.font.weight}),a._footerTextHeight=getTextHeight({fontFamily:a.footer.font.family,fontSize:a.footer.font.size,fontWeight:a.footer.font.weight}),a}return _inherits(d,Rect),_createClass(d,null,[{key:"MAX_WIDTH",value:function(){return 350}},{key:"MAX_HEIGHT",value:function(){return 500}},{key:"PADDING",value:function(){return{top:15,right:15,bottom:15,left:15}}},{key:"ICON",value:function(){return{width:25,height:25}}}]),_createClass(d,[{key:"draw",value:function(n){var r=this,t=this.x+this.w,e=this.y+this.h;n.save(),n.strokeStyle="rgba(0,0,0,0.2)",n.shadowColor="rgba(0,0,0,0.2)",n.shadowBlur=6,n.shadowOffsetX=6,n.shadowOffsetY=6,n.beginPath(),n.lineWidth="2",n.moveTo(this.x+5,this.y),n.lineTo(t-5,this.y),n.quadraticCurveTo(t,this.y,t,this.y+5),n.lineTo(t,this.y+this.h-5),n.quadraticCurveTo(t,e,t-5,e),n.lineTo(this.x+5,e),n.quadraticCurveTo(this.x,e,this.x,e-5),n.lineTo(this.x,this.y+5),n.quadraticCurveTo(this.x,this.y,this.x+5,this.y),n.stroke(),n.fillStyle="rgb(255,255,255)",n.fill(),n.closePath(),n.restore(),this.connections.forEach(function(t){t.draw(n)});var a=void 0,i=void 0;if(this.header){this.header.icon&&n.drawImage(img,this.x+d.PADDING().left,this.y+d.PADDING().top,d.ICON().width,d.ICON().height);var o=void 0;o=this._headerTextHeight.height<d.ICON().height?((a=d.PADDING().top+d.ICON().height+d.PADDING().bottom)-this._headerTextHeight.ascent)/2:(a=d.PADDING().top+this._headerTextHeight.ascent+d.PADDING().bottom,d.PADDING().top),n.textBaseline="top",n.font=this.header.font.style+" "+this.header.font.variant+" "+this.header.font.weight+" "+this.header.font.size+"px "+this.header.font.family,n.fillStyle=this.header.font.color,n.textAlign=this.header.alignment,n.fillText(this.header.text,this.x+d.PADDING().left+d.ICON().width+d.PADDING().right,this.y+o),i=d.PADDING().left+d.ICON().width+d.PADDING().right+n.measureText(this.header.text).width+d.PADDING().right,n.save(),n.strokeStyle="rgba(0,0,0,0.2)",n.lineWidth="1",n.beginPath(),n.moveTo(this.x,this.y+a),n.lineTo(this.x+this.w,this.y+a),n.stroke(),n.closePath(),n.restore()}n.measureText(this.header.text).width,n.measureText(this.body.text).width;n.measureText(this.footer.text).width;var s=0,l=0;if(this.body){n.font=this.body.font.style+" "+this.body.font.variant+" "+this.body.font.weight+" "+this.body.font.size+"px "+this.body.font.family,n.fillStyle=this.body.font.color,n.textAlign=this.body.alignment,n.textBaseline="top";var h=[],c=this.body.text.split(" "),f=0;c.forEach(function(t){var e=n.measureText(t).width,i=n.measureText(h[f]||"").width;d.PADDING().left+i+e+d.PADDING().right>d.MAX_WIDTH()&&f++;var o=h[f]||"";h[f]=o+=(0<o.length?" ":"")+t}),h.forEach(function(t,e){var i=r.y+a+r._bodyTextHeight.height*e+d.PADDING().top;n.fillText(t,r.x+d.PADDING().left,i);var o=n.measureText(t).width;l=l<o?o:l}),s=d.PADDING().top+h.length*this._bodyTextHeight.height+d.PADDING().bottom,l+=d.PADDING().left+d.PADDING().right}var y=0,u=0;this.footer&&(n.save(),n.strokeStyle="rgba(0,0,0,0.2)",n.lineWidth="1",n.beginPath(),n.moveTo(this.x,this.y+a+s),n.lineTo(this.x+this.w,this.y+a+s),n.stroke(),n.closePath(),n.restore(),n.textBaseline="top",n.font=this.footer.font.style+" "+this.footer.font.variant+" "+this.footer.font.weight+" "+this.footer.font.size+"px "+this.footer.font.family,n.fillStyle=this.footer.font.color,n.textAlign=this.footer.alignment,n.alignment="top",n.fillText(this.footer.text,this.x+d.PADDING().left,this.y+a+s+d.PADDING().top),y=d.PADDING().top+this._footerTextHeight.height+d.PADDING().bottom,u=d.PADDING().left+n.measureText(this.footer.text).width+d.PADDING().right);var g=l<i&&u<i?i:u<l?l:u;this.w=g,this.h=a+s+y}}]),d}(),Connection=function(){function o(t,e){_classCallCheck(this,o);var i=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t.x,t.y));return i.from=t,i.to=e,i}return _inherits(o,Entity),_createClass(o,[{key:"draw",value:function(e){if(0<this.path.length){e.lineWidth="2",e.strokeStyle="rgb(200,200,200)",e.beginPath(),e.moveTo(this.path[0].x,this.path[0].y),this.path.forEach(function(t){e.lineTo(Math.ceil(t.x),Math.ceil(t.y)),e.stroke()}),e.closePath();var t=this.path[this.path.length-1],i=this.path[this.path.length-2];t.x==i.x?t.y>i.y?(e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x+10,t.y-10),e.lineTo(t.x-10,t.y-10)):(e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x-10,t.y+10),e.lineTo(t.x+10,t.y+10)):t.x>i.x?(e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x-10,t.y-10),e.lineTo(t.x-10,t.y+10)):(e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x+10,t.y-10),e.lineTo(t.x+10,t.y+10)),e.fillStyle="rgb(200,200,200)",e.fill(),e.closePath()}}},{key:"closesPoints",get:function(){var t=this,o=1/0,n={};return this.from.sides.forEach(function(i){t.to.sides.forEach(function(t){var e=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));e<o&&(o=e,n={from:i,to:t})})}),n}},{key:"path",get:function(){var t=this.closesPoints,e=t.from,i=t.to,o=Math.abs(i.x-e.x)/2,n=Math.abs(i.y-e.y)/2,r=[];return"left"===e.name&&"right"===i.name||"right"===e.name&&"left"===i.name?(e.x>i.x&&(o*=-1),r.push({x:e.x,y:e.y},{x:e.x+o,y:e.y},{x:i.x-o,y:i.y},{x:i.x,y:i.y})):"bottom"!==e.name&&"top"!==e.name||"right"!==i.name&&"left"!==i.name?"right"!==e.name&&"left"!==e.name||"top"!==i.name&&"bottom"!==i.name?("top"===e.name&&"bottom"===i.name||"bottom"===e.name&&"top"===i.name)&&(e.y>i.y&&(n*=-1),r.push({x:e.x,y:e.y},{x:e.x,y:e.y+n},{x:i.x,y:i.y-n},{x:i.x,y:i.y})):r.push({x:e.x,y:e.y},{x:i.x,y:e.y},{x:i.x,y:i.y}):r.push({x:e.x,y:e.y},{x:e.x,y:i.y},{x:i.x,y:i.y}),r}}]),o}(),Graph=function(){function e(t){_classCallCheck(this,e),this.rects=t}return _createClass(e,[{key:"rects2JSON",get:function(){return JSON.parse(this.rects)}}]),e}(),Canvas=function(){function l(t,e){var h=this,i=e.w,o=e.h,n=e.options,r=e.data;_classCallCheck(this,l),this.isDrawing=!1,this.el=t,this.el.width=i||400,this.el.height=o||400,this.origin={x:0,y:0},this.entities={},this._isDraggingCanvas=!1,this.isDebugging=!0,this.drawOrigin=!1,this.scaleLimits={max:n.maxZoom||l.MAX_SCALE(),min:n.minZoom||l.MIN_SCALE()},this.fps=n.fps||60;var a={horizontal:1,vertical:1};this.getScale=function(){return a},this.setScale=function(t,e){var i=a.horizontal*t,o=a.vertical*e;i<h.scaleLimits.max&&o<h.scaleLimits.max&&i>=h.scaleLimits.min&&o>=h.scaleLimits.min&&(a={horizontal:i,vertical:o})};var c=[],s=null,f=!1;this.el.addEventListener("mousemove",function(t){if(h._isDraggingCanvas)h.translate(t.movementX,t.movementY);else if(s){f=!0;var e=(t.x-h.origin.x)/h.getScale().horizontal,i=(t.y-h.origin.y)/h.getScale().vertical;s.x=e-s.w/2,s.y=i-s.h/2}}),this.el.addEventListener("dblclick",function(t){var e=(t.x-h.origin.x)/h.getScale().horizontal,i=(t.y-h.origin.y)/h.getScale().vertical;h.addEntity(new Block({x:e,y:i,header:{text:"Lorem ipsum dolor sit",alignment:"start",font:{family:"Times",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:25,weight:"bold"},icon:"./bell.svg"},body:{text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at consectetur lorem. Etiam dignissim dolor sit amet orci efficitur auctor.",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}},footer:{text:"Lorem ipsum dolor sit",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}}}))}),this.el.addEventListener("click",function(t){var s=(t.x-h.origin.x)/h.getScale().horizontal,l=(t.y-h.origin.y)/h.getScale().vertical;if(f)f=!1;else{for(var e=function(t){var e=h.entitiesArray[t];if(e.contains(s,l)){if(0===c.length?c.push(e):c.forEach(function(t){t._id!==e._id&&c.push(e)}),2==c.length){for(var i=c.pop(),o=c.pop(),n=!1,r=0;r<o.connections.length;r++){if(o.connections[r].to._id===i._id){n=!0;break}}for(var a=0;a<i.connections.length;a++){if(i.connections[a].to._id===o._id){n=!0;break}}n||o.addConnection(i),c=[]}return{v:void 0}}},i=0;i<h.entitiesArray.length;i++){var o=e(i);if("object"===(void 0===o?"undefined":_typeof(o)))return o.v}c=[]}}),this.el.addEventListener("mousedown",function(t){for(var e=(t.x-h.origin.x)/h.getScale().horizontal,i=(t.y-h.origin.y)/h.getScale().vertical,o=0;o<h.entitiesArray.length;o++){var n=h.entitiesArray[o];if(n.contains(e,i))return void(s=s||n)}h._isDraggingCanvas=!0}),this.el.addEventListener("mouseup",function(t){h._isDraggingCanvas=!1,s=s&&null}),this.el.addEventListener("wheel",function(t){0<t.wheelDelta?h.setScale(1.01,1.01):h.setScale(.99,.99)}),r&&this.setData(r),this.start()}return _createClass(l,null,[{key:"MAX_SCALE",value:function(){return 2}},{key:"MIN_SCALE",value:function(){return.2}}]),_createClass(l,[{key:"start",value:function(){var e=this;setInterval(function(){e.isDrawing&&(e.clear(),e.isDebugging&&e.drawOrigin&&(e.ctx.moveTo(e.origin.x,e.origin.y),e.ctx.lineTo(e.origin.x,e.origin.y+e.el.height),e.ctx.moveTo(e.origin.x,e.origin.y),e.ctx.lineTo(e.origin.x+e.el.width,e.origin.y),e.ctx.moveTo(e.origin.x,e.origin.y),e.ctx.lineTo(e.origin.x-e.el.width,e.origin.y),e.ctx.moveTo(e.origin.x,e.origin.y),e.ctx.lineTo(e.origin.x,e.origin.y-e.el.height),e.ctx.stroke()),e.ctx.save(),e.ctx.translate(e.origin.x,e.origin.y),e.ctx.scale(e.getScale().horizontal,e.getScale().vertical),Object.values(e.entities).forEach(function(t){t.draw(e.ctx)}),e.ctx.restore())},1e3/this.fps)}},{key:"resize",value:function(t,e){this.el.width=t,this.el.height=e}},{key:"addEntity",value:function(t){this.entities[t._id]=t}},{key:"removeEntity",value:function(t){delete this.entities[t._id]}},{key:"clear",value:function(){this.ctx.clearRect(0,0,canvas.width,canvas.height)}},{key:"translate",value:function(t,e){this.origin.x+=t,this.origin.y+=e}},{key:"setData",value:function(t){var i={};if(t&&t.blocks&&0<Object.values(t.blocks).length){var e=!0,o=!1,n=void 0;try{for(var r,a=Object.entries(t.blocks)[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value,l=_slicedToArray(s,2),h=l[0],c=l[1];if(c){var f=new Block(c);this.addEntity(f),i[h]=f}}}catch(t){o=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(o)throw n}}var y=function(e,t){t&&t.connections&&t.connections.forEach(function(t){i[t]&&i[e].addConnection(i[t])})},u=!0,g=!1,d=void 0;try{for(var m,x=Object.entries(t.blocks)[Symbol.iterator]();!(u=(m=x.next()).done);u=!0){var v=m.value,b=_slicedToArray(v,2);y(b[0],b[1])}}catch(t){g=!0,d=t}finally{try{!u&&x.return&&x.return()}finally{if(g)throw d}}}this.isDrawing=!0}},{key:"ctx",get:function(){return this.el.getContext("2d")}},{key:"entitiesArray",get:function(){return Object.values(this.entities)}}]),l}();function initCanvas(t){var e=t||document.getElementById("canvas"),i=new Canvas(e,{w:window.innerWidth,h:window.innerHeight,options:{backgroundColor:"transparent",fps:60,maxZoom:2,minZoom:.2,drawOrigin:!1},data:{blocks:{a:{x:50,y:50,connections:["b","c"],header:{text:"Lorem ipsum dolor sit",alignment:"start",font:{family:"Times",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:25,weight:"bold"},icon:"./bell.svg"},body:{text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at consectetur lorem. Etiam dignissim dolor sit amet orci efficitur auctor.",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}},footer:{text:"Lorem ipsum dolor sit",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}}},b:{x:400,y:400,connections:["c"],header:{text:"Header",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"},icon:"./bell.svg"},body:{text:"Body",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}},footer:{text:"Footer",alignment:"start",font:{family:"Arial",style:"normal",variant:"normal",color:"rgba(0,0,0,0.6)",size:20,weight:"bold"}}},c:{x:700,y:800,connections:["a"]}}}});window.addEventListener("resize",function(){i.resize(window.innerWidth,window.innerHeight)},!1)}var getTextHeight=function(t){var e=t.fontFamily,i=t.fontSize,o=t.fontWeight,n=document.createElement("span");n.innerHTML="Hg",n.style.fontFamily=e,n.style.fontSize=i,n.style.fontWeight=o||"normal";var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.height="0px";var a=document.createElement("div");a.append(n,r),document.body.appendChild(a);try{var s={};r.style.verticalAlign="baseline",s.ascent=r.offsetTop-n.offsetTop,r.style.verticalAlign="bottom",s.height=r.offsetTop-n.offsetTop,s.descent=s.height-s.ascent}finally{a.remove()}return s};